<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Mark's Notes]]></title>
  <subtitle><![CDATA[I think therefore I am]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://ztmark.github.io/"/>
  <updated>2016-03-14T07:29:36.000Z</updated>
  <id>http://ztmark.github.io/</id>
  
  <author>
    <name><![CDATA[Mark]]></name>
    <email><![CDATA[shuyumark@gmail.com]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[二叉查找树]]></title>
    <link href="http://ztmark.github.io/2016/03/14/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91/"/>
    <id>http://ztmark.github.io/2016/03/14/二叉查找树/</id>
    <published>2016-03-13T16:00:00.000Z</published>
    <updated>2016-03-14T07:29:36.000Z</updated>
    <content type="html"><![CDATA[<p>二叉查找树代码实现，包括遍历的递归和非递归实现。</p>
<a id="more"></a>
<p><a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%85%83%E6%90%9C%E5%B0%8B%E6%A8%B9" target="_blank" rel="external">二叉查找树</a>又叫二叉搜索树，它是一棵二叉树，它的根节点的左孩子的值小于其根节点的值，根节点的右孩子的值大于根节点的值，并且根节点的左孩子和由孩子也是二叉查找树。可见其定义具有递归性质，二叉搜索树的操作基本上可以使用递归来完成。</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/bst.png" alt="bst"></p>
<p>这就是一棵二叉搜索树。</p>
<p>二叉搜索树的期望高度为$O(logN)$，所以它的搜索，插入，删除等操作的时间复杂度是$O(logN)$，但也可能会出现坏的情况，比如在构造二叉搜索树的时候依次插入1,2,3,4,5那么，二叉搜索树就退化成一个链表了。</p>
<h2 id="二叉搜索树的构造">二叉搜索树的构造</h2><p>二叉搜索树的节点需要保存值，父节点指针，左孩子和由孩子的指针。值一般会是一个对象类型，该对象类型要实现比较的功能，在Java中，就是要实现Comparable接口。这里使用最简单的int整型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Node parent;</span><br><span class="line">   <span class="keyword">private</span> Node left;</span><br><span class="line">   <span class="keyword">private</span> Node right;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.value = value;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>插入节点：如果二叉搜索树为空，插入的节点就当做根节点，如果二叉搜索已经包含了要插入的节点那就直接返回，否则，就从根节点开始往下找，找到适合的位置插入。还有一种递归的方式就是如果根节点为空，就把要插入的节点返回，否则比较根节点和要插入的值，如果小于根节点的值，就插入根节点的左孩子，否则插入到右孩子。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">   Node node = <span class="keyword">new</span> Node(<span class="keyword">value</span>);</span><br><span class="line">   <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">       root = node;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (contains(<span class="keyword">value</span>)) &#123;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Node p = <span class="keyword">null</span>;</span><br><span class="line">   Node cur = root;</span><br><span class="line">   <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">       p = cur;</span><br><span class="line">       <span class="keyword">if</span> (cur.<span class="keyword">value</span> &lt; <span class="keyword">value</span>) &#123;</span><br><span class="line">           cur = cur.right;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           cur = cur.left;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   node.parent = p;</span><br><span class="line">   <span class="keyword">if</span> (p.<span class="keyword">value</span> &lt; <span class="keyword">value</span>) &#123;</span><br><span class="line">       p.right = node;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       p.left = node;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="节点的删除">节点的删除</h2><p>节点的删除分三种情况：</p>
<ol>
<li>该节点没有左子树和右子树</li>
<li>该节点只有左子树</li>
<li>该节点只有右子树</li>
</ol>
<p>第一种情况，直接删除节点即可。</p>
<p>第二种情况，找到左子树的最大值节点，交换该最大值节点的值，然后删除最大值节点。</p>
<p>第三种情况，找到右子树的最小值节点，交换最小值节点的值，然后删除最小值节点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">   Node val = find(value);</span><br><span class="line">   removeNode(val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">removeNode</span><span class="params">(Node val)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (val == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"SBT is not contain "</span> + val.value);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (val.left == <span class="keyword">null</span> &amp;&amp; val.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (val.parent == root) &#123;</span><br><span class="line">           root = <span class="keyword">null</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val.parent.left == val)&#123;</span><br><span class="line">           val.parent.left = <span class="keyword">null</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           val.parent.right = <span class="keyword">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">       Node max = maxNode(val.left);</span><br><span class="line">       swap(max, val);</span><br><span class="line">       removeNode(max);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       Node min = minNode(val.right);</span><br><span class="line">       swap(min, val);</span><br><span class="line">       removeNode(min);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(Node n1, Node n2)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> tmp = n1.value;</span><br><span class="line">   n1.value = n2.value;</span><br><span class="line">   n2.value = tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="节点的查找">节点的查找</h2><p>二叉搜索树的查找，即判断二叉搜索树是否包含给定的值，只要从根节点开始往下比较即可。递归的思路就是如果根节点不是要找的值就根据根节点和要找的值的大小来递归调用在子树中查找。</p>
<p>找最小值就是一直最左下方的那个值，最大值就是最右下方的那个值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">   Node cur = root;</span><br><span class="line">   <span class="keyword">while</span> (cur != <span class="keyword">null</span> &amp;&amp; cur.value != value) &#123;</span><br><span class="line">       <span class="keyword">if</span> (cur.value &lt; value) &#123;</span><br><span class="line">           cur = cur.right;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           cur = cur.left;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> cur != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BST is empty."</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> maxNode(root).value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">maxNode</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   Node cur = root;</span><br><span class="line">   <span class="keyword">while</span> (cur.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">       cur = cur.right;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BST is empty"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   Node min = minNode(root);</span><br><span class="line">   <span class="keyword">return</span> min.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">minNode</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   Node cur = root;</span><br><span class="line">   <span class="keyword">while</span> (cur.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">       cur = cur.left;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="寻找节点的前驱节点和后继节点">寻找节点的前驱节点和后继节点</h2><p>前驱和后继节点就是在中序遍历序列中，与节点紧邻的前一个节点和后一个节点。</p>
<p>前驱：如果节点有左子树，那么前驱就是左子树中的最大节点，否则就要寻找离该节点最近的那个节点，使得该节点位于那个节点的左子树中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!contains(value)) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BST not contains "</span> + value);</span><br><span class="line">   &#125;</span><br><span class="line">   Node val = find(value);</span><br><span class="line">   <span class="keyword">if</span> (val.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> maxNode(val.left).value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Node p = val.parent;</span><br><span class="line">   <span class="keyword">while</span> (p != <span class="keyword">null</span> &amp;&amp; p.left == val) &#123;</span><br><span class="line">       val = p;</span><br><span class="line">       p = val.parent;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> Integer.MIN_VALUE; <span class="comment">// 不存在 该如何处理 ？抛异常？</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> p.value;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后继：后继和前驱类似，如果节点有右子树，那么前驱就是右子树中的最小节点，否则就要寻找离该节点最近的那个节点，使得该节点位于那个节点的右子树中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">successor</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!contains(value)) &#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"BST is not contain "</span> + value);</span><br><span class="line">   &#125;</span><br><span class="line">   Node val = find(value);</span><br><span class="line">   <span class="keyword">if</span> (val.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> minNode(val.right).value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   Node p = val.parent;</span><br><span class="line">   <span class="keyword">while</span> (p != <span class="keyword">null</span> &amp;&amp; p.right == val) &#123;</span><br><span class="line">       val = p;</span><br><span class="line">       p = val.parent;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> Integer.MAX_VALUE; <span class="comment">// 不存在 该如何处理 ？抛异常？</span></span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> p.value;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二叉搜索树的遍历">二叉搜索树的遍历</h2><h3 id="前序遍历">前序遍历</h3><p>前序遍历：就是先处理根节点，再分别递归处理左子树中的节点和右子树中的节点。</p>
<p>递归的方式很简单，这里主要讲一下如何实现非递归方式。</p>
<p>非递归这里有两种方式：</p>
<ul>
<li>首先一直向左下方遍历，即先一直处理左孩子并添加到栈中，直到左孩子为空，然后查看栈顶元素（就算当前节点的父节点）的右孩子是否就是当前节点，如果是就弹出栈顶元素作为当前节点，继续判断栈顶元素的右孩子是否就是当前节点，直到栈为空，或者当前节点不是栈顶元素的右孩子，那么就开始处理栈顶元素的右孩子。</li>
<li>先将根节点添加到栈中，然后不断弹出栈顶元素，处理该元素，然后分别将栈的右孩子和左孩子压人栈中，这样之后弹出的就先是左孩子然后才是右孩子。</li>
</ul>
<p>显然，第二种方式更加的简单。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">preorder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// return preOrder(root);</span></span><br><span class="line">   <span class="keyword">return</span> preOrderNonRecursive();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">preOrder</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   order.add(root.value);</span><br><span class="line">   order.addAll(preOrder(root.left));</span><br><span class="line">   order.addAll(preOrder(root.right));</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">preOrderNonRecursive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   Stack&lt;Node&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">   stack.push(root);</span><br><span class="line">   order.add(root.value);</span><br><span class="line">   Node cur = root.left;</span><br><span class="line">   Node p;</span><br><span class="line">   <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">           order.add(cur.value);</span><br><span class="line">           stack.push(cur);</span><br><span class="line">           cur = cur.left;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">           p = cur;</span><br><span class="line">           cur = stack.peek().right;</span><br><span class="line">           <span class="keyword">if</span> (p == cur) &#123;</span><br><span class="line">               cur = stack.pop();</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">preOrderNonRecursive1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   Stack&lt;Node&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">   stack.push(root);</span><br><span class="line">   Node cur;</span><br><span class="line">   <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">       cur = stack.pop();</span><br><span class="line">       order.add(cur.value);</span><br><span class="line">       <span class="keyword">if</span> (cur.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">           stack.push(cur.right);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (cur.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">           stack.push(cur.left);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="中序遍历">中序遍历</h3><p>中序遍历：就是先递归处理左子树，再分处理根节点，最后递归处理右子树中的节点。</p>
<p>递归的方式很简单，这里主要讲一下如何实现非递归方式。</p>
<p>非递归的方式就是先一直将节点的左孩子压入栈中知道左孩子为空，这时候弹出栈顶元素，处理该元素，然后如果其有右孩子就将其右孩子压入栈，然后继续处理左孩子，如果没有右孩子，则弹出栈顶元素。以此往复。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">inorder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> inOrder(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">inOrder</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   order.addAll(inOrder(root.left));</span><br><span class="line">   order.add(root.value);</span><br><span class="line">   order.addAll(inOrder(root.right));</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">inOrderNonRecursive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   Stack&lt;Node&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">   Node cur = root;</span><br><span class="line">   <span class="keyword">while</span> (cur != <span class="keyword">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">           stack.push(cur);</span><br><span class="line">           cur = cur.left;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (!stack.isEmpty()) &#123;</span><br><span class="line">           cur = stack.pop();</span><br><span class="line">           order.add(cur.value);</span><br><span class="line">           cur = cur.right;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="后序遍历">后序遍历</h3><p>后序遍历：就是先分别递归处理左子树中的节点和右子树中的节点，再处理根节点。</p>
<p>递归的方式很简单，这里主要讲一下如何实现非递归方式。</p>
<p>非递归的方式主要难点是在判断节点的右孩子是否已经处理过了。这里在处理完一个节点时，先判断该节点是否是父节点的右孩子，如果是，就不再处理父节点的右孩子，直接处理父节点，如果不是，再处理父节点的右孩子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">postorder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> postOrder(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">postOrder</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   order.addAll(postOrder(root.left));</span><br><span class="line">   order.addAll(postOrder(root.right));</span><br><span class="line">   order.add(root.value);</span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">postOrderNonRecursive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   List&lt;Integer&gt; order = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> order;</span><br><span class="line">   &#125;</span><br><span class="line">   Stack&lt;Node&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">   Node cur = root;</span><br><span class="line">   stack.push(cur);</span><br><span class="line">   cur = root.left;</span><br><span class="line">   Node p;</span><br><span class="line">   <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">       <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">           stack.add(cur);</span><br><span class="line">           cur = cur.left;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">           p = cur;</span><br><span class="line">           cur = stack.peek().right;</span><br><span class="line">           <span class="keyword">if</span> (p == cur) &#123;</span><br><span class="line">               cur = stack.pop();</span><br><span class="line">               order.add(cur.value);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成代码见<a href="https://github.com/ztmark/Java-Playground/blob/master/src/main/java/com/mark/datastructure/BinarySearchTree.java" target="_blank" rel="external">Githug</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>二叉查找树代码实现，包括遍历的递归和非递归实现。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Bloom Filter]]></title>
    <link href="http://ztmark.github.io/2016/03/08/Bloom%20Filter/"/>
    <id>http://ztmark.github.io/2016/03/08/Bloom Filter/</id>
    <published>2016-03-08T11:53:56.000Z</published>
    <updated>2016-03-08T11:53:56.000Z</updated>
    <content type="html"><![CDATA[<p>Bloom Filter简介。</p>
<a id="more"></a>
<p><a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8" target="_blank" rel="external">布隆过滤器</a>是用来判断一个元素是否在集合中的数据结构，它使用一系列Hash函数和一个位数组来判断。</p>
<p>首先需要准备一个长度为m的位数组，每一位初始化为0，然后在存元素的时候通过k个Hash函数分别将元素映射到数组的k个位置，并设置为1。之后在判断某一元素是否存在于集合中就只需要判断通过k个Hash函数分别将元素映射到数组的k个位是否都为1，如果不是，那么该元素一定不在集合中，如果是，那么元素有一定概率在集合中，这个概率是多少，取决于m，k和存储在集合中的元素个数n。</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Bloom_filter.png" alt="Bloom Filter"></p>
<p>上图将x,y,z存入集合，将对应的位设为1，然后查询w是否在集合中，由于通过3个Hash函数计算出来的对应位置有一位不为1，则表示w不在集合中。</p>
<p>概率如何计算：<a href="https://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives" target="_blank" rel="external">Probability of false positives</a>这里讲的比较详细了。</p>
<p>其实我们可以发现如果m越长，n越少，k越多那么误判的几率就越低。</p>
<p>k的选择需要考虑m和n的值，可以详看上面的链接，这里直接给出k取$(\frac mn)ln2$为最佳。</p>
<p>Bloom Filter的时间和空间优势还是挺明显的，相比较HashSet等其他方式来判断是否在集合中，空间上由于Bloom Filter并不存储数据本身，而只用了一个位数组，这能极大的节省空间，时间上面需要通过k个Hash函数，可以认为是常数的复杂度。缺点就是会出现误判，也不支持删除操作。</p>
<p>虽然Bloom Filter通过合理的选择m和k能有效降低误判，但是还是免不了出现误判，所以Bloom Filter适合哪些不要求百分百正确的场景，比如垃圾邮件，黑名单等等。</p>
<p>代码如下（<a href="https://github.com/ztmark/bfj" target="_blank" rel="external">Github地址</a>）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.ztmark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.ImmutableList;</span><br><span class="line"><span class="keyword">import</span> com.google.common.hash.HashFunction;</span><br><span class="line"><span class="keyword">import</span> com.google.common.hash.Hashing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BloomFilter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BitSet bitSet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> bitSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> expectedNumberOfElements;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ImmutableList&lt;HashFunction&gt; hashFunctions;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> addedNumberOfElements;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BloomFilter</span><span class="params">(<span class="keyword">int</span> bitSize, <span class="keyword">int</span> expectedNumberOfElements)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bitSize &lt;= <span class="number">0</span> || expectedNumberOfElements &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"wrong parameters bitSize and expectedNumberOfElements should greater than zero."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.bitSize = bitSize;</span><br><span class="line">        bitSet = <span class="keyword">new</span> BitSet(bitSize);</span><br><span class="line">        <span class="keyword">this</span>.expectedNumberOfElements = expectedNumberOfElements;</span><br><span class="line">        <span class="comment">// k = m / n * ln2</span></span><br><span class="line">        k = (<span class="keyword">int</span>) Math.round(<span class="number">1.0</span> * bitSize / expectedNumberOfElements * Math.log(<span class="number">2</span>));</span><br><span class="line">        hashFunctions = HashFunctionGenerator.generateKHashFunctions(k);</span><br><span class="line">        addedNumberOfElements = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T elem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (HashFunction function : hashFunctions) &#123;</span><br><span class="line">            bitSet.set(Math.abs(function.hashInt(elem.hashCode()).asInt() / bitSize));</span><br><span class="line">        &#125;</span><br><span class="line">        addedNumberOfElements++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T elem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (HashFunction function : hashFunctions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!bitSet.get(Math.abs(function.hashInt(elem.hashCode()).asInt() / bitSize))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getFalsePositiveProbability</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// p = (1 - e^(-k * n / m)) ^ k</span></span><br><span class="line">        <span class="keyword">return</span> Math.pow((<span class="number">1</span> - Math.exp(-k * <span class="number">1.0</span> * addedNumberOfElements / bitSize)), k);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAddedNumberOfElements</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addedNumberOfElements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBitSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bitSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getExpectedNumberOfElements</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expectedNumberOfElements;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumberOfHashFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">HashFunctionGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HashFunction <span class="title">generateAHashFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Hashing.murmur3_128(<span class="keyword">new</span> Random(System.currentTimeMillis()).nextInt());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImmutableList&lt;HashFunction&gt; <span class="title">generateKHashFunctions</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">            Random random = <span class="keyword">new</span> Random(System.currentTimeMillis());</span><br><span class="line">            List&lt;HashFunction&gt; hashFunctions = <span class="keyword">new</span> ArrayList&lt;HashFunction&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">                hashFunctions.add(Hashing.murmur3_128(random.nextInt()));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ImmutableList.copyOf(hashFunctions);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Bloom Filter简介。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[KMP算法]]></title>
    <link href="http://ztmark.github.io/2016/02/29/KMP%E7%AE%97%E6%B3%95/"/>
    <id>http://ztmark.github.io/2016/02/29/KMP算法/</id>
    <published>2016-02-28T16:00:00.000Z</published>
    <updated>2016-02-29T07:38:20.000Z</updated>
    <content type="html"><![CDATA[<p>KMP算法笔记。</p>
<a id="more"></a>
<p>详见<a href="https://zh.wikipedia.org/wiki/%E5%85%8B%E5%8A%AA%E6%96%AF-%E8%8E%AB%E9%87%8C%E6%96%AF-%E6%99%AE%E6%8B%89%E7%89%B9%E7%AE%97%E6%B3%95" target="_blank" rel="external">KMP算法wiki</a></p>
<p>KMP算法对蛮力的改进主要在当失配的时候，模式串不是移动一位，而是根据模式串本身的特性进行移动多位，来提升匹配的速度。</p>
<p>这里关键一步就是求出失配时该移动多少位，也就是常说的next数组。</p>
<p><a href="http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html" target="_blank" rel="external">这篇</a>文章对next数组的讲解比较简单易懂。</p>
<p><strong>next数组就是模式串的最长的相等的前缀和后缀的长度</strong>。比如<code>ababacb</code></p>
<ul>
<li>next[0]: <code>a</code>的前缀和后缀是都是空，则next[0]=0</li>
<li>next[1]: <code>ab</code>的前缀是[<code>a</code>]，后缀是[<code>b</code>]，没有相等的前缀和后缀，所有next[1]=0</li>
<li>next[2]: <code>aba</code>的前缀[<code>a</code>，<code>ab</code>]，后缀是[<code>a</code>，<code>ba</code>]，最长的相等的前缀和后缀是<code>a</code>，所有next[2]=1</li>
<li>next[3]: <code>abab</code>的前缀[<code>a</code>，<code>ab</code>，<code>aba</code>]，后缀是[<code>a</code>，<code>ab</code>，<code>bab</code>]，最长的相等的前缀和后缀是<code>ab</code>，所有next[3]=2</li>
<li>next[4]: <code>ababa</code>的前缀[<code>a</code>，<code>ab</code>，<code>aba</code>，<code>abab</code>]，后缀是[<code>a</code>，<code>ba</code>，<code>aba</code>，<code>baba</code>]，最长的相等的前缀和后缀是<code>aba</code>，所有next[4]=3</li>
<li>next[5]: <code>ababac</code>的前缀[<code>a</code>，<code>ab</code>，<code>aba</code>，<code>abab</code>，<code>ababa</code>]，后缀是[<code>c</code>，<code>ac</code>，<code>bac</code>，<code>abac</code>，<code>babac</code>]，没有相等的前缀和后缀，所有next[5]=0</li>
<li>next[6]: <code>ababacb</code>的前缀[<code>a</code>，<code>ab</code>，<code>aba</code>，<code>abab</code>，<code>ababa</code>，<code>ababac</code>]，后缀是[<code>b</code>，<code>cb</code>，<code>acb</code>，<code>bacb</code>，<code>abacb</code>,<code>babacb</code>]，没有相等的前缀和后缀，所有next[6]=0</li>
</ul>
<p>那么到底该怎么求这个next数组呢？</p>
<p><strong>求next数组就是模式串和自己匹配的过程</strong>。</p>
<p>其实有一点可以很容易想到，在求next[j]的时候，我们已经求出了next[0]到next[j-1]了，比如<code>ababacb</code>，</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>next</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>在求next[4]的时候，我们已经求出了next[0..3]，我们知道next[3]=2，也就是说p[0..1]=p[2..3]，那么，要是p[2]=p[4]，next[4]就等于next[3]+1。p[2]也就是p[next[3]]。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>p</td>
<td></td>
<td></td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
</tr>
</tbody>
</table>
<p>求next[4]的时候，不管怎样，我们先将字符串p向右移动2个字符使得p[2]和p[4]对齐，看看p[2]和p[4]是否相等。</p>
<p>让哪个字符和p[4]对其是这么算的，因为知道next[3]=2，p[0..1]=p[2..3]，也就是p[2]应该和p[4]对齐，就是p[next[3]]。</p>
<p>如果相等，next[4]就等于next[3]+1。这里正好相等，所以next[4]=2+1=3。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>next</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td></td>
</tr>
</tbody>
</table>
<p>现在求next[5]，不管怎样，我们先将字符串p向右移动2个字符使得p[3]和p[5]对齐，看看p[3]和p[5]是否相等。为什么是p[3]，因为next[4]=3。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>p</td>
<td></td>
<td></td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
</tr>
</tbody>
</table>
<p>这里p[5]不等于p[3]，那怎么办呢，之前说了，求next其实就是模式串的自我匹配，这里匹配不成功，那我们就需要将下面的p进行右移，移动多少个字符，还是要看next数组，因为是p[3]匹配不成功，但是p[0..2]是匹配的，那就右移使得p[next[2]]和p[5]对齐。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>p</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>a</td>
<td>b</td>
<td>a</td>
</tr>
</tbody>
</table>
<p>这时p[1]和p[5]对齐，发现p[1]不等于p[5]，我们继续右移，使得p[next[1]]和p[5]对齐。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>p</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>a</td>
<td>b</td>
</tr>
</tbody>
</table>
<p>这时p[0]和p[5]对齐，但p[0]不等于p[5]，此时，我们无法在进行右移了，所以直接让next[5]=0。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>c</td>
<td>b</td>
</tr>
<tr>
<td>next</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>现在求next[6]，因为next[5]=0，所以应该让p[0]和p[6]对齐，看看p[0]是否等于p[6]，不相等，而next[0]=0，所以直接让next[6]=0。</p>
<p>求出next数组之后，KMP算法就算完成一大半了。KMP算法主体和蛮力匹配类似，但是在不匹配的时候文本串不动，移动模式串。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(String text, String pattern)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span>[] next = next(pattern);</span><br><span class="line">   <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; text.length(); i++) &#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (j == pattern.length()) &#123;</span><br><span class="line">               <span class="keyword">return</span> i - j;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (text.charAt(i) == pattern.charAt(j)) &#123;</span><br><span class="line">               j++;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span>)&#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               j = next[j - <span class="number">1</span>];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] next(String pattern) &#123;</span><br><span class="line">   <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[pattern.length()];</span><br><span class="line">   next[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; pattern.length(); i++) &#123;</span><br><span class="line">       <span class="keyword">int</span> j = i - <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span> (j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (pattern.charAt(next[j]) == pattern.charAt(i)) &#123;</span><br><span class="line">               next[i] = next[j] + <span class="number">1</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (next[j] == <span class="number">0</span>)&#123;</span><br><span class="line">               next[i] = <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               j = next[j - <span class="number">1</span>];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>KMP算法笔记。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[LeetCode Longest Palindromic Substring 和 Manacher 算法]]></title>
    <link href="http://ztmark.github.io/2016/02/20/LeetCode%20Longest%20Palindromic%20Substring%20%E9%A2%98%E8%A7%A3/"/>
    <id>http://ztmark.github.io/2016/02/20/LeetCode Longest Palindromic Substring 题解/</id>
    <published>2016-02-19T16:00:00.000Z</published>
    <updated>2016-02-20T09:17:11.000Z</updated>
    <content type="html"><![CDATA[<p>LeetCode Longest Palindromic Substring 题解。</p>
<a id="more"></a>
<p><a href="https://leetcode.com/problems/longest-palindromic-substring/" target="_blank" rel="external">题目</a></p>
<p>题目就是要求找出给定字符串的最长回文子串。</p>
<h2 id="Constraints">Constraints</h2><ol>
<li>输入是一个字符串</li>
<li>字符串的长度范围为0~1000</li>
<li>字符串中一定存在一个唯一最长回文子字符串</li>
<li>要求返回这个子字符串</li>
</ol>
<h2 id="Ideas">Ideas</h2><h3 id="蛮力">蛮力</h3><p>从字符串的第一个字符作为回文子串的中心字符，检查这个回文子串的长度，再从第一个字符和第二个字符之间的空格作为回文子串的中心字符，检查这个回文子串的长度，依次类推，遍历完后返回最长的那个子串。</p>
<p>这个算法的时间复杂度为$O(n^2)$，空间复杂度为$O(1)$。</p>
<h3 id="Manacher_算法">Manacher 算法</h3><p>见<a href="https://en.wikipedia.org/wiki/Longest_palindromic_substring" target="_blank" rel="external">wikipedia</a></p>
<p>对于上面的蛮力算法，需要对回文子串的中心字符是原始字符串中的字符还是空白字符分别做处理。Manacher算法通过先对字符串做预处理使得之后不用考虑这个问题。<code>abba</code>变成<code>#a#b#b#a#</code>,这样子串的中心字符要么是<code>#</code>表示空白字符（这个字符可以任意只要不在原字符串中出现即可），要么就是原始字符串中的字符。</p>
<p>这里有一个问题，是否可以这么处理<code>abba</code>变成<code>a#b#b#a</code>,看样子是可以，但是还是会出现问题，比如这个<code>abb</code>变成<code>a#b#b</code>，在原始字符串中最长回文子串是<code>bb</code>，但在处理后的字符串<code>a#b#b</code>，以第一个<code>b</code>为中心字符的<code>#b#</code>长度为3，和以第二个<code>#</code>为中心的字符串<code>b#b</code>也为3。但是在原始字符串中，以第一个<code>b</code>为中心的回文子串长度为1，以第一个<code>b</code>和第二个<code>b</code>之间的空白字符为中心的回文子串<code>bb</code>才是长度最长的。</p>
<p>接下来，就可以查找出处理后的字符串的最长回文子串了。</p>
<p>首先需要一个数组R来保存以每一个字符作为中心字符的回文子串的半径长度。例如：</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8 </th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td><code>#</code></td>
<td>a</td>
<td><code>#</code></td>
<td>b</td>
<td><code>#</code></td>
<td>b</td>
<td><code>#</code></td>
<td>a</td>
<td><code>#</code></td>
</tr>
<tr>
<td>R</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0  </td>
</tr>
</tbody>
</table>
<p>可以发现R中的最大值就是原字符串的最长回文子串的长度。</p>
<p>其实这个也挺好理解的，处理后的字符串长度是原先的字符串长度的2倍加1，因为添加了length+1个<code>#</code>。在处理后的字符串s中，回文子串都是以s中的字符为中心的，去除了中心这个字符，回文子串的长度就是原串中回文子串长度的两倍，那么s的回文子串的半径长度就是原串中回文子串长度。</p>
<p>接下来就是要求这个R数组。</p>
<p>我们可以借助回文子串对称的特点来加快R的求解。</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>s</td>
<td>a</td>
<td>a</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>b</td>
<td>a</td>
<td>a</td>
<td>a</td>
<td>b</td>
</tr>
<tr>
<td>R</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>当我们在求R[7]的时候，我们已经求出了R[0]到R[6]的值，知道R[4]等于4，即R[0..8]是回文串，R[0]和R[8]相等，R[1]和R[7]相等,R[2]和R[6]相等，R[3]和R[5]相等，由此，我们知道以s[1]为中心的回文子串在没有超出s[0..8]中的字符是和以s[7]为中心的回文子串在没有超出s[0..8]中的字符相同的。所以，R[7]至少等于Min(R[1], 4+R[4] - 7)=1。</p>
<p>对于超出s[0..8]范围的字符，这里就只剩下s[9]了，我们只能按照蛮力的方式来计算了。</p>
<p>这里我们要用maxR记录已经算出的回文子串的最右边界,用id记录这个回文子串的中心字符的下标。</p>
<p>这个算法的时间复杂度为$O(n)$，空间复杂度为$O(n)$。这个时间复杂度主要看maxR是如何增长的，因为处理i&lt;maxR的情况时借助了前面已经计算出来的值，这一步为常数，而超出maxR范围的时候，每对比一次，maxR其实就增长1，当maxR为字符串长度时，之后的计算都只是使用之前已经计算的值而已。</p>
<h2 id="Code">Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">longestPalindrome</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.length() == <span class="number">0</span> || s.length() == <span class="number">1</span>) <span class="keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加#符号</span></span><br><span class="line">        <span class="comment">// 这里应该有一个候选的符号列表，从该符号列表选取符号</span></span><br><span class="line">        <span class="comment">// 先检测字符串s是否包含该符号，如果包含就重新选一个，不包含才进行添加</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(s.length() * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">        sb.append(<span class="string">'#'</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            sb.append(s.charAt(i)).append(<span class="string">'#'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String origin = s;</span><br><span class="line">        s = sb.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] R = <span class="keyword">new</span> <span class="keyword">int</span>[s.length()];</span><br><span class="line">        <span class="keyword">int</span> id = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> maxR = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; maxR) &#123;</span><br><span class="line">                <span class="comment">// 2 * id - i是i关于id的对称点</span></span><br><span class="line">                <span class="comment">// 因为题目里有说s的length最大为1000</span></span><br><span class="line">                <span class="comment">// 所以这里 2 * id是安全的</span></span><br><span class="line">                R[i] = Math.min(R[<span class="number">2</span> * id - i], maxR - i);</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">//else &#123;</span></span><br><span class="line">              <span class="comment">//  R[i] = 0; // 默认也是0</span></span><br><span class="line">            <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (i - R[i] &gt;= <span class="number">0</span> &amp;&amp; i + R[i] &lt; s.length() &amp;&amp; s.charAt(i - R[i]) == s.charAt(i + R[i])) &#123;</span><br><span class="line">                R[i]++;</span><br><span class="line">            &#125;</span><br><span class="line">            R[i]--; <span class="comment">// 减去s[i-0] == s[i+0]时加的</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i + R[i] &gt; maxR) &#123;</span><br><span class="line">                maxR = i + R[i];</span><br><span class="line">                id = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        id = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; R.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (R[i] &gt; R[id]) &#123;</span><br><span class="line">                id = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 慢一些 36ms</span></span><br><span class="line">        <span class="comment">//return s.substring(id - R[id], id + R[id]).replaceAll("#", "");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算出在原始字符串的位置 快一些 18ms</span></span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> end = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.charAt(mid) == <span class="string">'#'</span>) &#123;</span><br><span class="line">            start = mid / <span class="number">2</span> - max / <span class="number">2</span>;</span><br><span class="line">            end = mid / <span class="number">2</span> + max / <span class="number">2</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            start = (mid - <span class="number">1</span>) / <span class="number">2</span> - (max - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            end = (mid - <span class="number">1</span>) / <span class="number">2</span> + (max + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> origin.substring(start, end);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Test">Test</h2><p>LeetCode测试通过</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>LeetCode Longest Palindromic Substring 题解。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[LeetCode Longest Increasing Subsequence 题解]]></title>
    <link href="http://ztmark.github.io/2016/02/17/LeetCode%20Longest%20Increasing%20Subsequence%20%E9%A2%98%E8%A7%A3/"/>
    <id>http://ztmark.github.io/2016/02/17/LeetCode Longest Increasing Subsequence 题解/</id>
    <published>2016-02-16T16:00:00.000Z</published>
    <updated>2016-02-17T15:29:26.000Z</updated>
    <content type="html"><![CDATA[<p>LeetCode Longest Increasing Subsequence 题解。</p>
<a id="more"></a>
<p><a href="https://leetcode.com/problems/longest-increasing-subsequence/" target="_blank" rel="external">原题</a></p>
<p>大意就是在一个未排序的数组中找出最长递增子序列的长度。</p>
<h2 id="Constraints">Constraints</h2><ol>
<li>未排序的int数组</li>
<li>数组长度未说明，可能为0</li>
<li>递增子序列：子序列就是从原数组中去除掉任意个元素（任意位置）所剩下的元素组成的序列（也就是说子序列中元素原先不必是相邻的），递增表示子序列后面的数比前面的大</li>
<li>返回最长子序列的长度，如果数组为0就返回0</li>
</ol>
<h2 id="Ideas">Ideas</h2><h3 id="第一个想法">第一个想法</h3><p>先创建一个数组dp，dp[i]表示以数组中第i个元素结尾的最长递增子序列的长度。</p>
<p>然后依次遍历数组中的每个元素，对于每一个遍历到的元素A，检查前面的所有子序列，看能不能将A添加到子序列末尾，如果能，这样就形成了一个更长的子序列。在所有能以A为结尾的子序列中找到最长的那个，然后更新dp数组对应的长度。</p>
<p>最后，dp数组中最大值就是所要的结果。</p>
<p>对于这个算法，每次遍历到一个数都要检查前面遍历过的数，时间复杂度是$O(n^2)$，因为要使用到dp数组，空间复杂度也为$O(n)$。</p>
<h3 id="第二个想法">第二个想法</h3><p>先创建一个数组dp，dp[i]表示长度为i的递增子序列的最后一个数的最小值。</p>
<p>然后依次遍历数组中的每个元素，在遍历到第i个元素时，查看dp数组中下标小于i的元素，如果有数比第i个元素大，就替换这个元素来保证dp[i]表示长度为i的递增子序列的最后一个数的最小值，如果有相等的就什么也不错，如果都比第i个元素小，那么将第i个元素值赋给dp[i]。</p>
<p>最后，dp数组中最后一个有值的元素的下标就是所要的结果。</p>
<p>对于这个算法，每次遍历到一个数都要检查前面遍历过的数，时间复杂度是$O(n^2)$，因为要使用到dp数组，空间复杂度也为$O(n)$。</p>
<h3 id="第三个想法">第三个想法</h3><p>可以发现在第二个算法中的dp数组应该是一个递增数组。因为每次遍历到第i个数，都只在该数比dp[0..i-1]的数大才将这个数设置给dp[i],所以该数组是递增的。</p>
<p>那么对于这个递增的数组我们可以使用二分查找来提升性能。</p>
<p>这时时间复杂度是$O(nlog(n))$，因为要使用到dp数组，空间复杂度也为$O(n)$。</p>
<h2 id="Code">Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongestIncreasingSubsequence300</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 算法一</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLIS</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> dp[] = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dp.length; i++) &#123;</span><br><span class="line">            dp[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> res = dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> max = dp[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] &lt; nums[i]) &#123;</span><br><span class="line">                    <span class="keyword">int</span> tmp = dp[j] + <span class="number">1</span>;</span><br><span class="line">                    max = max &lt; tmp ? tmp : max;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i] = max;</span><br><span class="line">            <span class="keyword">if</span> (dp[i] &gt; res) &#123;</span><br><span class="line">                res = dp[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    算法二</span><br><span class="line">    </span><br><span class="line">    dp[i]表示长度为i的递增子序列的最后一个数的可能的最小值  越小</span><br><span class="line">    那么就有更大的可能后面的的数比这个大 从而使整个递增子序列 更长</span><br><span class="line"></span><br><span class="line">    dp 数组是递增的  可以用反证法证明</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLIS2</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> dp[] = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length + <span class="number">1</span>]; <span class="comment">// dp[i]表示长度为i的递增子序列的最后一个数的可能的最小值</span></span><br><span class="line">        dp[<span class="number">0</span>] = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (; j &lt; res; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[j] == nums[i]) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dp[j] &gt; nums[i]) &#123; <span class="comment">// 原来的长度为i的递增子序列的最后一个数的可能的最小值 大于 当前遍历到的数</span></span><br><span class="line">                    dp[j] = nums[i];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (j == res) &#123; <span class="comment">// 当前遍历的数比dp之前的数都大，那么就出现了长度更长的递增子序列</span></span><br><span class="line">                dp[res++] = nums[i]; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    算法三</span><br><span class="line">    </span><br><span class="line">    对2的改进</span><br><span class="line">    因为dp是递增的，所以可以将线性遍历改为二分查找</span><br><span class="line">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLIS3</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> dp[] = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length + <span class="number">1</span>]; <span class="comment">// dp[i]表示长度为i的递增子序列的最后一个数的可能的最小值</span></span><br><span class="line">        dp[<span class="number">0</span>] = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// Arrays.binarySearch 在 数组的 [fromIndex, toIndex) 不包含toIndex 查找指定的数</span></span><br><span class="line">            <span class="comment">// 找不到 返回  -insertIndex-1</span></span><br><span class="line">            <span class="keyword">int</span> p = Arrays.binarySearch(dp, <span class="number">0</span>, res + <span class="number">1</span>, nums[i]);</span><br><span class="line">            <span class="keyword">if</span> (p &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                p = - (p + <span class="number">1</span>);</span><br><span class="line">                dp[p] = nums[i];</span><br><span class="line">                res = p &gt; res ? p : res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Test">Test</h2><p>LeetCode测试通过。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>LeetCode Longest Increasing Subsequence 题解。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[githug 通关攻略]]></title>
    <link href="http://ztmark.github.io/2016/02/15/githug%20%E9%80%9A%E5%85%B3%E6%94%BB%E7%95%A5/"/>
    <id>http://ztmark.github.io/2016/02/15/githug 通关攻略/</id>
    <published>2016-02-15T13:06:55.000Z</published>
    <updated>2016-02-15T13:18:40.000Z</updated>
    <content type="html"><![CDATA[<p>记录<code>Githug</code>通关过程。</p>
<a id="more"></a>
<p><a href="https://github.com/Gazler/githug" target="_blank" rel="external">githug</a>是一个git的命令行游戏。</p>
<p>levels:</p>
<p><a href="#第1关">#1: init</a><br><a href="#第2关">#2: config</a><br><a href="#第3关">#3: add</a><br><a href="#第4关">#4: commit</a><br><a href="#第5关">#5: clone</a><br><a href="#第6关">#6: clone_to_folder</a><br><a href="#第7关">#7: ignore</a><br><a href="#第8关">#8: include</a><br><a href="#第9关">#9: status</a><br><a href="#第10关">#10: number_of_files_committed</a><br><a href="#第11关">#11: rm</a><br><a href="#第12关">#12: rm_cached</a><br><a href="#第13关">#13: stash</a><br><a href="#第14关">#14: rename</a><br><a href="#第15关">#15: restructure</a><br><a href="#第16关">#16: log</a><br><a href="#第17关">#17: tag</a><br><a href="#第18关">#18: push_tags</a><br><a href="#第19关">#19: commit_amend</a><br><a href="#第20关">#20: commit_in_future</a><br><a href="#第21关">#21: reset</a><br><a href="#第22关">#22: reset_soft</a><br><a href="#第23关">#23: checkout_file</a><br><a href="#第24关">#24: remote</a><br><a href="#第25关">#25: remote_url</a><br><a href="#第26关">#26: pull</a><br><a href="#第27关">#27: remote_add</a><br><a href="#第28关">#28: push</a><br><a href="#第29关">#29: diff</a><br><a href="#第30关">#30: blame</a><br><a href="#第31关">#31: branch</a><br><a href="#第32关">#32: checkout</a><br><a href="#第33关">#33: checkout_tag</a><br><a href="#第34关">#34: checkout_tag_over_branch</a><br><a href="#第35关">#35: branch_at</a><br><a href="#第36关">#36: delete_branch</a><br><a href="#第37关">#37: push_branch</a><br><a href="#第38关">#38: merge</a><br><a href="#第39关">#39: fetch</a><br><a href="#第40关">#40: rebase</a><br><a href="#第41关">#41: repack</a><br><a href="#第42关">#42: cherry-pick</a><br><a href="#第43关">#43: grep</a><br><a href="#第44关">#44: rename_commit</a><br><a href="#第45关">#45: squash</a><br><a href="#第46关">#46: merge_squash</a><br><a href="#第47关">#47: reorder</a><br><a href="#第48关">#48: bisect</a><br><a href="#第49关">#49: stage_lines</a><br><a href="#第50关">#50: find_old_branch</a><br><a href="#第51关">#51: revert</a><br><a href="#第52关">#52: restore</a><br><a href="#第53关">#53: conflict</a><br><a href="#第54关">#54: submodule</a></p>
<h2 id="第1关">第1关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">init</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">1</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">A <span class="built_in">new</span> <span class="built_in">directory</span>, `git_hug`, has been created; initialize <span class="operator">an</span> <span class="constant">empty</span> repository <span class="operator">in</span> <span class="keyword">it</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> git_hug</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>
<h2 id="第2关">第2关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">config</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">2</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="sql"><span class="operator"><span class="keyword">Set</span> up your git <span class="keyword">name</span> <span class="keyword">and</span> email, this <span class="keyword">is</span> important so that your commits can be <span class="keyword">identified</span>.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config user<span class="class">.name</span> <span class="string">"mark"</span></span><br><span class="line">git config user<span class="class">.email</span> <span class="string">"shuyumark@gmail.com"</span></span><br><span class="line">git config --list</span><br></pre></td></tr></table></figure>
<h2 id="第3关">第3关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">add</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">3</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">There is <span class="operator">a</span> <span class="built_in">file</span> <span class="operator">in</span> your <span class="built_in">folder</span> called `README`, you should <span class="built_in">add</span> <span class="keyword">it</span> <span class="built_in">to</span> your staging area</span><br><span class="line">Note: You <span class="built_in">start</span> <span class="keyword">each</span> level <span class="operator">with</span> <span class="operator">a</span> <span class="built_in">new</span> repo. Don<span class="string">'t look for files from the previous one.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> <span class="keyword">add </span>README</span><br></pre></td></tr></table></figure>
<h2 id="第4关">第4关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">commit</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">4</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">The `README` <span class="type">file</span> has been added <span class="keyword">to</span> your staging area, now commit <span class="keyword">it</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="operator"><span class="keyword">commit</span> -<span class="keyword">m</span> <span class="string">'add README'</span></span></span><br></pre></td></tr></table></figure>
<h2 id="第5关">第5关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">clone</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">5</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="crmsh"><span class="keyword">Clone</span> <span class="title">the</span> repository at https://github.com/Gazler/cloneme.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/Gazler/cloneme</span><br></pre></td></tr></table></figure>
<h2 id="第6关">第6关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">clone_to_folder</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">6</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Clone <span class="operator">the</span> repository <span class="keyword">at</span> <span class="keyword">https</span>://github.com/Gazler/cloneme <span class="built_in">to</span> `my_cloned_repo`.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/Gazler/cloneme my_cloned_repo</span><br></pre></td></tr></table></figure>
<h2 id="第7关">第7关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">ignore</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">7</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">The <span class="keyword">text</span> editor <span class="string">'vim'</span> creates <span class="built_in">files</span> ending <span class="operator">in</span> `.swp` (swap <span class="built_in">files</span>) <span class="keyword">for</span> all <span class="built_in">files</span> that are currently <span class="built_in">open</span>.  We don<span class="string">'t want them creeping into the repository.  Make this repository ignore `.swp` files.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch <span class="class">.gitignore</span></span><br><span class="line">echo <span class="string">'*.swp'</span> &gt; .gitignore</span><br></pre></td></tr></table></figure>
<h2 id="第8关">第8关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">include</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">8</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Notice <span class="operator">a</span> few <span class="built_in">files</span> <span class="operator">with</span> <span class="operator">the</span> <span class="string">'.a'</span> extension.  We want git <span class="built_in">to</span> ignore all but <span class="operator">the</span> <span class="string">'lib.a'</span> <span class="built_in">file</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">'*.a'</span> <span class="prompt">&gt;&gt; </span>.gitignore </span><br><span class="line">echo <span class="string">'!lib.a'</span> <span class="prompt">&gt;&gt; </span>.gitignore</span><br></pre></td></tr></table></figure>
<h2 id="第9关">第9关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">status</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">9</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">There are some <span class="built_in">files</span> <span class="operator">in</span> this repository, <span class="constant">one</span> <span class="operator">of</span> <span class="operator">the</span> <span class="built_in">files</span> is untracked, which <span class="built_in">file</span> is <span class="keyword">it</span>?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">status</span></span><br></pre></td></tr></table></figure>
<h2 id="第10关">第10关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">number_of_files_committed</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">10</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">There are some <span class="built_in">files</span> <span class="operator">in</span> this repository, how many <span class="operator">of</span> <span class="operator">the</span> <span class="built_in">files</span> will be committed?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">status</span></span><br></pre></td></tr></table></figure>
<h2 id="第11关">第11关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">rm</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">11</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">A <span class="built_in">file</span> has been removed <span class="built_in">from</span> <span class="operator">the</span> working tree, however <span class="operator">the</span> <span class="built_in">file</span> was <span class="operator">not</span> removed <span class="built_in">from</span> <span class="operator">the</span> repository.  Find out what this <span class="built_in">file</span> was <span class="operator">and</span> remove <span class="keyword">it</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">git</span> <span class="tag">status</span></span><br><span class="line"><span class="tag">git</span> <span class="tag">rm</span> <span class="tag">deleteme</span><span class="class">.rb</span></span><br></pre></td></tr></table></figure>
<h2 id="第12关">第12关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">rm_cached</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">12</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">A <span class="built_in">file</span> has accidentally been added <span class="built_in">to</span> your staging area, find out which <span class="built_in">file</span> <span class="operator">and</span> remove <span class="keyword">it</span> <span class="built_in">from</span> <span class="operator">the</span> staging area.  *NOTE* Do <span class="operator">not</span> remove <span class="operator">the</span> <span class="built_in">file</span> <span class="built_in">from</span> <span class="operator">the</span> <span class="built_in">file</span> <span class="keyword">system</span>, only <span class="built_in">from</span> git.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm <span class="comment">--cached deleteme.rb</span></span><br></pre></td></tr></table></figure>
<h2 id="第13关">第13关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">stash</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">13</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="python">Yo<span class="string">u've made some changes and want to work on them later. You should save them, but don'</span>t commit them.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">git</span> stash</span><br></pre></td></tr></table></figure>
<h2 id="第14关">第14关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">rename</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">14</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">We have <span class="operator">a</span> <span class="built_in">file</span> called `oldfile.txt`. We want <span class="built_in">to</span> <span class="built_in">rename</span> <span class="keyword">it</span> <span class="built_in">to</span> `newfile.txt` <span class="operator">and</span> stage this change.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">git</span> <span class="tag">mv</span> <span class="tag">oldfile</span><span class="class">.txt</span> <span class="tag">newfile</span><span class="class">.txt</span></span><br></pre></td></tr></table></figure>
<h2 id="第15关">第15关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">restructure</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">15</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You added some <span class="built_in">files</span> <span class="built_in">to</span> your repository, but now realize that your project needs <span class="built_in">to</span> be restructured.  Make <span class="operator">a</span> <span class="built_in">new</span> <span class="built_in">folder</span> named `src` <span class="operator">and</span> <span class="keyword">using</span> Git move all <span class="operator">of</span> <span class="operator">the</span> .html <span class="built_in">files</span> <span class="keyword">into</span> this <span class="built_in">folder</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mkdir</span> src</span><br><span class="line">git mv <span class="regexp">*.html</span> src</span><br></pre></td></tr></table></figure>
<h2 id="第16关">第16关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">log</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">16</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You will be asked <span class="keyword">for</span> <span class="operator">the</span> hash <span class="operator">of</span> most recent commit.  You will need <span class="built_in">to</span> investigate <span class="operator">the</span> logs <span class="operator">of</span> <span class="operator">the</span> repository <span class="keyword">for</span> this.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="command">log</span></span><br></pre></td></tr></table></figure>
<h2 id="第17关">第17关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">tag</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">17</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">We have <span class="operator">a</span> git repo <span class="operator">and</span> we want <span class="built_in">to</span> tag <span class="operator">the</span> current commit <span class="operator">with</span> `new_tag`.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">new_tag</span> HEAD // 默认是HEAD，可以省略</span><br></pre></td></tr></table></figure>
<h2 id="第18关">第18关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">push_tags</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">18</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="crmsh">There are tags <span class="operator">in</span> the repository that aren't pushed into remote repository. Push them now.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">From /var/folders/<span class="number">3</span>t/kh85db8d1c39qhjhx_h0nxx00000gn/T/d20160215-<span class="number">3639</span>-<span class="number">161</span>bq0y/</span><br><span class="line"> * [new branch]      <span class="keyword">master</span>     <span class="title">-&gt; origin</span>/<span class="literal">master</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> <span class="keyword">push </span>origin master</span><br></pre></td></tr></table></figure>
<h2 id="第19关">第19关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">commit_amend</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">19</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">The `README` <span class="built_in">file</span> has been committed, but <span class="keyword">it</span> looks like <span class="operator">the</span> <span class="built_in">file</span> `forgotten_file.rb` was missing <span class="built_in">from</span> <span class="operator">the</span> commit.  Add <span class="operator">the</span> <span class="built_in">file</span> <span class="operator">and</span> amend your previous commit <span class="built_in">to</span> <span class="built_in">include</span> <span class="keyword">it</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">add</span> forgotten_file.rb</span><br><span class="line">git commit <span class="comment">--amend</span></span><br></pre></td></tr></table></figure>
<h2 id="第20关">第20关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">commit_in_future</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">20</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="sql"><span class="operator"><span class="keyword">Commit</span> your changes <span class="keyword">with</span> the future <span class="built_in">date</span> (<span class="keyword">e</span>.<span class="keyword">g</span>. tomorrow).</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit --<span class="keyword">help</span> <span class="comment">//查看doc</span></span><br><span class="line">git commit --<span class="keyword">date</span>=<span class="number">2016.02</span><span class="number">.16</span> -m <span class="string">'add README'</span></span><br></pre></td></tr></table></figure>
<h2 id="第21关">第21关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">reset</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">21</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">There are <span class="constant">two</span> <span class="built_in">files</span> <span class="built_in">to</span> be committed.  The goal was <span class="built_in">to</span> <span class="built_in">add</span> <span class="keyword">each</span> <span class="built_in">file</span> <span class="keyword">as</span> <span class="operator">a</span> separate commit, however both were added <span class="keyword">by</span> accident.  Unstage <span class="operator">the</span> <span class="built_in">file</span> `to_commit_second.rb` <span class="keyword">using</span> <span class="operator">the</span> reset <span class="command"><span class="keyword">command</span> (<span class="title">don</span><span class="string">'t commit anything).</span></span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="operator"><span class="keyword">reset</span> <span class="keyword">HEAD</span> to_commit_second.rb</span></span><br></pre></td></tr></table></figure>
<h2 id="第22关">第22关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">reset_soft</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">22</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You committed too soon. Now you want <span class="built_in">to</span> undo <span class="operator">the</span> <span class="keyword">last</span> commit, <span class="keyword">while</span> keeping <span class="operator">the</span> index.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="operator"><span class="keyword">reset</span> <span class="comment">--soft HEAD^</span></span></span><br></pre></td></tr></table></figure>
<h2 id="第23关">第23关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">checkout_file</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">23</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">A <span class="type">file</span> has been modified, <span class="keyword">but</span> you don't want <span class="keyword">to</span> keep <span class="keyword">the</span> modification.  Checkout <span class="keyword">the</span> `config.rb` <span class="type">file</span> <span class="keyword">from</span> <span class="keyword">the</span> <span class="keyword">last</span> commit.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout <span class="comment">-- config.rb</span></span><br></pre></td></tr></table></figure>
<h2 id="第24关">第24关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">remote</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">24</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="gradle"><span class="keyword">This</span> <span class="keyword">project</span> has a remote repository.  Identify it.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">git</span> remote -v</span><br></pre></td></tr></table></figure>
<h2 id="第25关">第25关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">remote_url</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">25</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">The remote repositories have <span class="operator">a</span> url associated <span class="built_in">to</span> them.  Please enter <span class="operator">the</span> url <span class="operator">of</span> remote_location.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">git</span> remote -v</span><br></pre></td></tr></table></figure>
<h2 id="第26关">第26关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">pull</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">26</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You need <span class="keyword">to</span> pull changes <span class="keyword">from</span> your origin repository.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin <span class="literal">master</span></span><br></pre></td></tr></table></figure>
<h2 id="第27关">第27关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">remote_add</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">27</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Add <span class="operator">a</span> remote repository called `origin` <span class="operator">with</span> <span class="operator">the</span> url <span class="keyword">https</span>://github.com/githug/githug</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="built_in">add</span> origin http<span class="variable">s:</span>//github.<span class="keyword">com</span>/githug/githug</span><br></pre></td></tr></table></figure>
<h2 id="第28关">第28关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">push</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">28</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="crmsh">Your local <span class="keyword">master</span> <span class="title">branch</span> has diverged from the remote origin/<span class="keyword">master</span> <span class="title">branch</span>. Rebase your commit onto origin/<span class="keyword">master</span> <span class="title">and</span> push it to remote.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull <span class="comment">--rebase</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<h2 id="第29关">第29关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">diff</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">29</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">There have been modifications <span class="built_in">to</span> <span class="operator">the</span> `app.rb` <span class="built_in">file</span> since your <span class="keyword">last</span> commit.  Find out which <span class="built_in">line</span> has changed.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">git</span> diff</span><br></pre></td></tr></table></figure>
<h2 id="第30关">第30关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">blame</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">30</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Someone has <span class="built_in">put</span> <span class="operator">a</span> password inside <span class="operator">the</span> <span class="built_in">file</span> `config.rb` find out who <span class="keyword">it</span> was.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> <span class="keyword">blame </span>config.rb</span><br></pre></td></tr></table></figure>
<h2 id="第31关">第31关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">branch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">31</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="oxygene">You want <span class="keyword">to</span> work <span class="keyword">on</span> a piece <span class="keyword">of</span> code that <span class="keyword">has</span> the potential <span class="keyword">to</span> <span class="keyword">break</span> things, <span class="keyword">create</span> the branch test_code.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> <span class="keyword">branch </span>test_code</span><br></pre></td></tr></table></figure>
<h2 id="第32关">第32关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">checkout</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">32</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Create <span class="operator">and</span> <span class="keyword">switch</span> <span class="built_in">to</span> <span class="operator">a</span> <span class="built_in">new</span> branch called my_branch.  You will need <span class="built_in">to</span> <span class="built_in">create</span> <span class="operator">a</span> branch like you did <span class="operator">in</span> <span class="operator">the</span> previous level.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -<span class="tag">b</span> my_branch</span><br></pre></td></tr></table></figure>
<h2 id="第33关">第33关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">checkout_tag</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">33</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You need <span class="built_in">to</span> fix <span class="operator">a</span> bug <span class="operator">in</span> <span class="operator">the</span> <span class="built_in">version</span> <span class="number">1.2</span> <span class="operator">of</span> your app. Checkout <span class="operator">the</span> tag `v1<span class="number">.2</span>`.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> checkout <span class="literal">v1</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="第34关">第34关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">checkout_tag_over_branch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">34</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You need <span class="built_in">to</span> fix <span class="operator">a</span> bug <span class="operator">in</span> <span class="operator">the</span> <span class="built_in">version</span> <span class="number">1.2</span> <span class="operator">of</span> your app. Checkout <span class="operator">the</span> tag `v1<span class="number">.2</span>` (Note: There is also <span class="operator">a</span> branch named `v1<span class="number">.2</span>`).</span></span><br></pre></td></tr></table></figure>
<p>这里有个分支和tag都叫v1.2，想切换到v1.2分支直接<code>git checkout v1.2</code>就可以，想切换到v1.2的tag,为了区别v1.2分支就需要指定tag，<code>git checkout tags/v1.2</code></p>
<h2 id="第35关">第35关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">branch_at</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">35</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You forgot <span class="keyword">to</span> branch <span class="keyword">at</span> <span class="keyword">the</span> previous commit <span class="keyword">and</span> made a commit <span class="function_start"><span class="keyword">on</span></span> top <span class="keyword">of</span> <span class="keyword">it</span>. Create branch test_branch <span class="keyword">at</span> <span class="keyword">the</span> commit <span class="keyword">before</span> <span class="keyword">the</span> <span class="keyword">last</span>.</span></span><br></pre></td></tr></table></figure>
<p><code>HEAD^</code>指向当前提交的上一次提交，<code>git branch test_branch HEAD^</code>就在上一个提交处创建了一个test_branch的分支</p>
<h2 id="第36关">第36关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">delete_branch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">36</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You have created too many branches <span class="keyword">for</span> your project. There is <span class="operator">an</span> old branch <span class="operator">in</span> your repo called <span class="string">'delete_me'</span>, you should <span class="built_in">delete</span> <span class="keyword">it</span>.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> <span class="keyword">branch </span>-d delete_me</span><br></pre></td></tr></table></figure>
<h2 id="第37关">第37关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">push_branch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">37</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="python">Yo<span class="string">u've made some changes to a local branch and want to share it, but aren'</span>t yet ready to merge it <span class="keyword">with</span> the <span class="string">'master'</span> branch.  Push only <span class="string">'test_branch'</span> to the remote repository</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin <span class="built_in">test</span>_branch:<span class="built_in">test</span>_branch</span><br></pre></td></tr></table></figure>
<h2 id="第38关">第38关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">merge</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">38</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">We have <span class="operator">a</span> <span class="built_in">file</span> <span class="operator">in</span> <span class="operator">the</span> branch <span class="string">'feature'</span>; Let<span class="string">'s merge it to the master branch.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">merge</span> feature</span><br></pre></td></tr></table></figure>
<h2 id="第39关">第39关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">fetch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">39</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Looks like <span class="operator">a</span> <span class="built_in">new</span> branch was pushed <span class="keyword">into</span> our remote repository. Get <span class="operator">the</span> changes <span class="keyword">without</span> merging them <span class="operator">with</span> <span class="operator">the</span> <span class="built_in">local</span> repository</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">git</span> fetch</span><br></pre></td></tr></table></figure>
<h2 id="第40关">第40关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">rebase</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">40</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="vbnet">We are <span class="keyword">using</span> a git rebase workflow <span class="keyword">and</span> the feature branch <span class="keyword">is</span> ready <span class="keyword">to</span> go <span class="keyword">into</span> master. <span class="keyword">Let</span><span class="comment">'s rebase the feature branch onto our master branch.</span></span></span><br></pre></td></tr></table></figure>
<p>详见<a href="http://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA" target="_blank" rel="external">rebase</a></p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature </span><br><span class="line">git rebase <span class="keyword">master</span></span><br><span class="line"><span class="title">git</span> checkout <span class="keyword">master</span></span><br><span class="line"><span class="title">git</span> merge feature</span><br></pre></td></tr></table></figure>
<h2 id="第41关">第41关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">repack</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">41</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">Optimise how your repository <span class="keyword">is</span> packaged ensuring <span class="keyword">that</span> redundant packs are removed.</span></span><br></pre></td></tr></table></figure>
<p>详见<a href="https://www.kernel.org/pub/software/scm/git/docs/git-repack.html" target="_blank" rel="external">repack</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git repack <span class="operator">-d</span></span><br></pre></td></tr></table></figure>
<h2 id="第42关">第42关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">cherry-pick</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">42</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">Your new feature <span class="keyword">isn't</span> worth <span class="keyword">the</span> <span class="property">time</span> <span class="keyword">and</span> you're going <span class="keyword">to</span> delete <span class="keyword">it</span>. But <span class="keyword">it</span> has one commit <span class="keyword">that</span> fills <span class="keyword">in</span> `README` <span class="type">file</span>, <span class="keyword">and</span> you want this commit <span class="keyword">to</span> be <span class="function_start"><span class="keyword">on</span></span> <span class="keyword">the</span> master <span class="keyword">as</span> well.</span></span><br></pre></td></tr></table></figure>
<p>见<a href="http://git-scm.com/book/zh/v2/分布式-Git-维护项目#将贡献的工作整合进来" target="_blank" rel="external">cherry-pick</a></p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout<span class="instruction"> new-feature </span></span><br><span class="line">git log</span><br><span class="line">git checkout master </span><br><span class="line">git cherry-pick ca32a6d</span><br></pre></td></tr></table></figure>
<h2 id="第43关">第43关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">grep</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">43</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="vbnet">Your project<span class="comment">'s deadline approaches, you should evaluate how many TODOs are left in your code</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">grep</span> TODO</span><br></pre></td></tr></table></figure>
<h2 id="第44关">第44关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">rename_commit</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">44</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">Correct <span class="operator">the</span> typo <span class="operator">in</span> <span class="operator">the</span> message <span class="operator">of</span> your <span class="keyword">first</span> (non-root) commit.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br><span class="line">git rebase -i <span class="number">58885</span>b7</span><br></pre></td></tr></table></figure>
<p>将<code>First coommit</code>那行的pick 改为reword，然后保存，之后就可以修改提交信息</p>
<h2 id="第45关">第45关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">squash</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">45</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="vim">You have committed several times but would like <span class="keyword">all</span> those <span class="keyword">changes</span> <span class="keyword">to</span> <span class="keyword">be</span> one commit.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br><span class="line">git rebase -<span class="built_in">i</span> f733099</span><br></pre></td></tr></table></figure>
<p>将要squash的行的pick 改为squash，然后保存，之后就可以修改提交信息</p>
<h2 id="第46关">第46关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">merge_squash</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">46</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="smali">Merge all commits from the<span class="instruction"> long-feature-branch </span>as a single commit.</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint</strong>：Take a look at the <code>--squash</code> option of the merge command. Don’t forget to commit the merge!</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git merge --squash<span class="instruction"> long-feature-branch</span><br><span class="line"></span>git commit -m 'update'</span><br></pre></td></tr></table></figure>
<h2 id="第47关">第47关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">reorder</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">47</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You have committed several <span class="keyword">times</span> <span class="keyword">but</span> <span class="keyword">in</span> <span class="keyword">the</span> wrong order. Please reorder your commits.</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint:</strong> Take a look the <code>-i</code> flag of the rebase command.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -<span class="tag">i</span> HEAD^^</span><br></pre></td></tr></table></figure>
<p>然后调换两个commit的顺序即可。</p>
<h2 id="第48关">第48关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">bisect</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">48</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">***</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">A bug was introduced somewhere along <span class="operator">the</span> way.  You know that running `ruby prog.rb <span class="number">5</span>` should output <span class="number">15.</span>  You can also run `make test`.  What are <span class="operator">the</span> <span class="keyword">first</span> <span class="number">7</span> <span class="keyword">chars</span> <span class="operator">of</span> <span class="operator">the</span> hash <span class="operator">of</span> <span class="operator">the</span> commit that introduced <span class="operator">the</span> bug.</span></span><br></pre></td></tr></table></figure>
<p><code>git bisect</code>通过二分查找来帮助查找是哪个commit引入错误。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git bisect start <span class="comment">// 开始查找</span></span><br><span class="line">git bisect bad <span class="comment">// 标记当前有问题</span></span><br><span class="line">git bisect good f608824 <span class="comment">// 标记第一次提交是没问题的</span></span><br><span class="line"><span class="comment">// 之后git自动会将head指向中间的那个commit</span></span><br><span class="line">ruby prog<span class="class">.rb</span> <span class="number">5</span> <span class="comment">// 检测是否有问题</span></span><br><span class="line">git bisect good <span class="comment">// 标记这次提交是没问题的</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>一直重复，就能找到出错的commit。</p>
<h2 id="第49关">第49关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">stage_lines</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">49</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You've made changes within a single <span class="type">file</span> <span class="keyword">that</span> belong <span class="keyword">to</span> two different features, <span class="keyword">but</span> neither <span class="keyword">of</span> <span class="keyword">the</span> changes are yet staged. Stage only <span class="keyword">the</span> changes belonging <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">first</span> feature.</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint:</strong> 查看<code>git add</code>的说明。</p>
<p><code>git add -e feature.rb</code>然后删除不想add的变更。</p>
<h2 id="第50关">第50关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">find_old_branch</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">50</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You have been working <span class="function_start"><span class="keyword">on</span></span> a branch <span class="keyword">but</span> got distracted <span class="keyword">by</span> a major issue <span class="keyword">and</span> forgot <span class="keyword">the</span> <span class="property">name</span> <span class="keyword">of</span> <span class="keyword">it</span>. Switch <span class="keyword">back</span> <span class="keyword">to</span> <span class="keyword">that</span> branch.</span></span><br></pre></td></tr></table></figure>
<p>使用<code>git reflog</code>来查看是从哪个分支切换过来的。</p>
<h2 id="第51关">第51关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">revert</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">51</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="applescript">You have committed several <span class="keyword">times</span> <span class="keyword">but</span> want <span class="keyword">to</span> undo <span class="keyword">the</span> <span class="keyword">middle</span> commit.</span><br><span class="line">All commits have been pushed, so you can't change existing history.</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint</strong> <code>git revert</code></p>
<p><code>git revert HEAD^</code></p>
<h2 id="第52关">第52关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">restore</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">52</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="sql">You decided to <span class="operator"><span class="keyword">delete</span> your latest <span class="keyword">commit</span> <span class="keyword">by</span> running <span class="string">`git reset --hard HEAD^`</span>.  (<span class="keyword">Not</span> a smart thing <span class="keyword">to</span> <span class="keyword">do</span>.)  You <span class="keyword">then</span> <span class="keyword">change</span> your mind, <span class="keyword">and</span> want that <span class="keyword">commit</span> back.  <span class="keyword">Restore</span> the deleted <span class="keyword">commit</span>.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br><span class="line">git <span class="operator"><span class="keyword">reset</span> <span class="comment">--hard e601101</span></span></span><br></pre></td></tr></table></figure>
<h2 id="第53关">第53关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">conflict</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">53</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">****</span></span><br><span class="line"></span><br><span class="line"><span class="sql">You need to <span class="operator"><span class="keyword">merge</span> mybranch <span class="keyword">into</span> the <span class="keyword">current</span> branch (<span class="keyword">master</span>). But there may be <span class="keyword">some</span> incorrect changes <span class="keyword">in</span> mybranch which may cause conflicts. Solve <span class="keyword">any</span> <span class="keyword">merge</span>-conflicts you come across <span class="keyword">and</span> <span class="keyword">finish</span> the <span class="keyword">merge</span>.</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">merge</span> mybranch<span class="comment"></span><br><span class="line">//打开poem.txt 解决冲突</span></span><br><span class="line">git <span class="built_in">add</span> .</span><br><span class="line">git commit</span><br></pre></td></tr></table></figure>
<h2 id="第54关">第54关</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Name</span>: <span class="string">submodule</span></span><br><span class="line"><span class="attribute">Level</span>: <span class="string">54</span></span><br><span class="line"><span class="attribute">Difficulty</span>: <span class="string">**</span></span><br><span class="line"></span><br><span class="line"><span class="livecodeserver">You want <span class="built_in">to</span> <span class="built_in">include</span> <span class="operator">the</span> <span class="built_in">files</span> <span class="built_in">from</span> <span class="operator">the</span> following repo: `<span class="keyword">https</span>://github.com/jackmaney/githug-<span class="built_in">include</span>-me` <span class="keyword">into</span> <span class="operator">a</span> <span class="operator">the</span> <span class="built_in">folder</span> `./githug-<span class="built_in">include</span>-me`. Do this <span class="keyword">without</span> cloning <span class="operator">the</span> repo <span class="operator">or</span> copying <span class="operator">the</span> <span class="built_in">files</span> <span class="built_in">from</span> <span class="operator">the</span> repo <span class="keyword">into</span> this repo.</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint:</strong> <code>git submodule</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule <span class="built_in">add</span> -- http<span class="variable">s:</span>//github.<span class="keyword">com</span>/jackmaney/githug-include-<span class="keyword">me</span> ./githug-include-<span class="keyword">me</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>记录<code>Githug</code>通关过程。</p>]]>
    
    </summary>
    
      <category term="Git" scheme="http://ztmark.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[排序算法总结]]></title>
    <link href="http://ztmark.github.io/2016/01/19/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://ztmark.github.io/2016/01/19/排序算法总结/</id>
    <published>2016-01-18T16:00:00.000Z</published>
    <updated>2016-02-27T02:42:23.000Z</updated>
    <content type="html"><![CDATA[<p>排序算法总结。</p>
<a id="more"></a>
<p><a href="http://zh.wikipedia.org/zh/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95" target="_blank" rel="external">排序算法</a></p>
<p>这里讨论的一律是对整数排序，并且目标是从小到大排序。</p>
<h2 id="常见排序算法">常见排序算法</h2><ul>
<li><a href="#冒泡排序">冒泡排序</a></li>
<li><a href="#插入排序">插入排序</a></li>
<li><a href="#选择排序">选择排序</a></li>
<li><a href="#归并排序">归并排序</a></li>
<li><a href="#希尔排序">希尔排序</a></li>
<li><a href="#堆排序">堆排序</a></li>
<li><a href="#快速排序">快速排序</a></li>
<li><a href="#计数排序">计数排序</a></li>
</ul>
<h2 id="冒泡排序">冒泡排序</h2><p>冒泡排序是通过每次比较相邻的两个元素，如果顺序错误就交换他们的位置来进行排序，一趟遍历下来，最大的元素就在正确的位置上了，每趟遍历，都要进行很多的元素位置交换，对一个大小为N的数组进行排序，需要进行N-1这样的遍历，需要$O(n^2)$的比较和交换。</p>
<p>冒泡排序的最坏和平均时间复杂度是$O(n^2)$,空间复杂度为$O(1)$,是一种原地的，稳定的排序算法。在复杂度为$O(n^2)$的排序算法中，冒泡的效率也没有其他的插入排序和选择排序高。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Bubble_sort_animation.gif?attname=&amp;e=1422537287&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:eNGEhItLDwvjJ_xSLKv4-UiqnS8" alt="此处输入图片的描述"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length - <span class="number">1</span>; i++) &#123; <span class="comment">// n-1次循环就可以，n-1个元素在正确的位置上，那唯一个元素也一定在正确的位置上</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; array.length - i; j++) &#123; <span class="comment">// i 是排好序的元素个数，且是数组中最大的i个元素，在数组的尾部</span></span><br><span class="line">                <span class="keyword">if</span> (array[j-<span class="number">1</span>].compareTo(array[j]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    swap(array, j-<span class="number">1</span>, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="鸡尾酒排序">鸡尾酒排序</h2><p>冒泡排序的变形版，是在两端来回的遍历，将最大值置换到最后，将最小置换到最前。就像一个球在两堵墙之间不断的来回弹，随着来回弹的次数增加，两堵墙之间的距离越来越小，当两堵墙相遇时，就排好序了。</p>
<p>鸡尾酒排序的最好和最坏时间复杂度还是$O(n^2)$，与冒泡不同的一点是对于已经差不多排好序的数组，其比较次数会比冒泡少。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/cocktail_sorting_shaker_sort_anim.gif?attname=&amp;e=1422538773&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:dCrbI4yXgp1qySp8pbcq4lRF5BE" alt="鸡尾酒排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">cocktailSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//一趟来回遍历将两个元素排好序，将所有元素都排好序需要array.length/2趟</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length / <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//将大值置换到尾部</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; array.length - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[j].compareTo(array[j+<span class="number">1</span>]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    swap(array, j, j+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将小值置换到头部</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = array.length - <span class="number">1</span> - i; j &gt; i + <span class="number">1</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[j].compareTo(array[j-<span class="number">1</span>]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    swap(array, j-<span class="number">1</span>, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="插入排序">插入排序</h2><p>插入排序是通过将元素插入到已排序序列的适当位置来实现排序。一开始，认为第一个元素是已排序的，然后，从第二个元素开始，向前遍历，在每次比较的时候，将较大的值后移，直到找到合适的位置插入。</p>
<p>插入排序的平均和最坏时间复杂度为$O(n^2)$，平均需要$O(n^2)$次比较，空间复杂度是$O(1)$，是一种原地的，稳定的排序算法。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Insertion_sort_animation.gif?attname=&amp;e=1422538048&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:Hed9X_6DeSNbAZwBbXnKH3MsHjg" alt="插入排序"></p>
<p>例子</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Insertion-sort-example.gif?attname=&amp;e=1422538048&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:hPsUFbMOjGKAAxw-rqeJ2cq3IUM" alt="例子"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">insertionSort</span><span class="params">(T[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = left+<span class="number">1</span>; i &lt;= right; i++) &#123; <span class="comment">// 第一个元素是排好序的</span></span><br><span class="line">            T tmp = array[i];</span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; tmp.compareTo(array[j-<span class="number">1</span>]) &lt; <span class="number">0</span>) &#123; <span class="comment">// 向前寻找适合位置</span></span><br><span class="line">                array[j] = array[j-<span class="number">1</span>];</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            array[j] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="选择排序">选择排序</h2><p>选择排序通过是每次选择未排序的序列中最小的元素，插入到已排序序列的最后位置来排序。</p>
<p>选择排序的平均和最坏时间复杂度为$O(n^2)$，$O(n)$次交换，空间复杂度为$O(1)$，是一种原地的，不稳定排序算法。</p>
<p>稳定性的反例：对 $3_1\ 2\ 3_2\ 1\ 4$ 进行选择排序，在第一次交换时，$3_i$会与$1$进行交换，最后排好序的样子是这样的 $1\ 2\ 3_2\ 3_1\ 4$，$3$的原先的顺序改变了。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Selection_sort_animation.gif?attname=&amp;e=1422540556&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:bGX4KEUoW0W71fQUl7sePMU2bz0" alt="选择排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            T min = array[i];</span><br><span class="line">            <span class="keyword">int</span> minIndex = i;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; array.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (min.compareTo(array[j]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    min = array[j];</span><br><span class="line">                    minIndex = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(array, i, minIndex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="归并排序">归并排序</h2><p>归并排序采用分治思想的排序算法，将数组分成两部分，分别对这两部分进行归并排序，最后将排序好的两部分进行合并。</p>
<p>归并算法的平均和最坏时间复杂度为$O(nlogn)$，空间复杂度是$O(n)$,因为需要额外的一个数组来进行合并操作，是个稳定的排序算法。java的Arrays类中的sort方法就使用到了归并排序。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Merge_sort_animation2.gif?attname=&amp;e=1422542195&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:LCONIVlS-GuGo33rSiOHqrFLw3M" alt="归并排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">    T[] tmp = (T[]) <span class="keyword">new</span> Comparable[array.length];</span><br><span class="line">    mergeSort(array, tmp, <span class="number">0</span>, array.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(T[] array, T[] tmpArray, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> center = (left + right) / <span class="number">2</span>;</span><br><span class="line">        mergeSort(array, tmpArray, left, center);</span><br><span class="line">        mergeSort(array, tmpArray, center+<span class="number">1</span>, right);</span><br><span class="line">        merge(array, tmpArray, left, center+<span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(T[] array, T[] tmpArray, <span class="keyword">int</span> leftPos, <span class="keyword">int</span> rightPos, <span class="keyword">int</span> rightEnd)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> leftEnd = rightPos - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tmpPos = leftPos;</span><br><span class="line">    <span class="keyword">int</span> num = rightEnd - leftPos + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (leftPos &lt;= leftEnd &amp;&amp; rightPos &lt;= rightEnd) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array[leftPos].compareTo(array[rightPos]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            tmpArray[tmpPos++] = array[leftPos++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tmpArray[tmpPos++] = array[rightPos++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (leftPos &lt;= leftEnd) &#123;</span><br><span class="line">        tmpArray[tmpPos++] = array[leftPos++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (rightPos &lt;= rightEnd) &#123;</span><br><span class="line">        tmpArray[tmpPos++] = array[rightPos++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将tmpArray中的 leftPos 到 rightEnd 的数据 拷贝到 array的对应位置上</span></span><br><span class="line">    <span class="comment">// 上面leftPos,rightPos都变了，rightEnd没有变，所以上面是先算了个数，这里用到</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++,rightEnd--) &#123;</span><br><span class="line">        array[rightEnd] = tmpArray[rightEnd];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="希尔排序">希尔排序</h2><p>希尔排序就是不断减少间隔的插入排序。</p>
<p>首先选定一个间隔gap，然后对所有间隔gap的数进行插入排序，这样所有间隔gap的数都是有序的，然后减小间隔gap，再次对所有间隔gap的数进行排序，不断重复这样的操作，直到间隔gap为1执行普通的插入排序，此时，数组是大致有序的，所以执行插入排序比较快。</p>
<p>对间隔gap的选择会影响算法的性能，简便起见可以选择数组长度的一半。希尔排序的复杂度分析比较复杂，一般可以认为平均时间复杂度为$O(nlogn)$，空间复杂度为$O(1)$。是一种原地的，不稳定排序算法。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Sorting_shellsort_anim.gif?attname=&amp;e=1422582531&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:ITRzF0-sEprwG7K1EGY4qIwUO4Y" alt="希尔排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> gap = array.length / <span class="number">2</span>; gap &gt; <span class="number">0</span>; gap /= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = gap; i &lt; array.length; i++) &#123; <span class="comment">//i++ 对所有间隔gap的数进行插入排序</span></span><br><span class="line">                T tmp = array[i];</span><br><span class="line">                <span class="keyword">int</span> j = i;</span><br><span class="line">                <span class="keyword">while</span> (j &gt;= gap &amp;&amp; tmp.compareTo(array[j-gap]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    array[j] = array[j-gap];</span><br><span class="line">                    j -= gap;</span><br><span class="line">                &#125;</span><br><span class="line">                array[j] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="堆排序">堆排序</h2><p>堆排序是借助堆(最大堆，最小堆)来进行排序的。首先建堆，然后通过n次的删除操作来得到有序序列。</p>
<p>堆排序的平均和最坏时间复杂度为$O(nlog)$，空间复杂度为$O(1)$。是一种原地不稳定排序算法。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Sorting_heapsort_anim.gif?attname=&amp;e=1422582531&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:Z0dEgHMUwVyXUpzULnSZU4Um7kY" alt="堆排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = array.length / <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123; <span class="comment">// build heap</span></span><br><span class="line">            percDown(array, i, array.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = array.length-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            swap(array, <span class="number">0</span>, i); <span class="comment">// delete max ， i 是heap的逻辑大小 将max放在heap的最后面</span></span><br><span class="line">            percDown(array, <span class="number">0</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    build max heap</span><br><span class="line">    i  是要下沉的节点</span><br><span class="line">    n  是heap的大小</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">percDown</span><span class="params">(T[] array, <span class="keyword">int</span> i, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        T tmp = array[i];</span><br><span class="line">        <span class="keyword">while</span> (leftChild(i) &lt; n) &#123;</span><br><span class="line">            <span class="keyword">int</span> child = leftChild(i);</span><br><span class="line">            <span class="keyword">if</span> (child != n-<span class="number">1</span> &amp;&amp; array[child+<span class="number">1</span>].compareTo(array[child]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                child++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (tmp.compareTo(array[child]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                array[i] = array[child];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i = child;</span><br><span class="line">        &#125;</span><br><span class="line">        array[i] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="快速排序">快速排序</h2><p>快速排序也是采用分治思想的一个排序算法，将数组分成两部分，对这两部分分别进行快速排序。</p>
<p>在对数组进行分的时候，选择一个值作为pivot，将数组分为小于pivot的和大于pivot的两部分，pivot选的好坏将直接影响快速排序的算法性能。一个好的pivot需要将数组平均分成两部分，一般可以选择这么一个策略：选择数组头尾两个数和中间一个数这三个数中大小处于中间的那个数作为pivot。</p>
<p>快速排序的平均时间复杂度为$O(nlogn)$，最坏时间复杂度为$O(n^2)$，这是因为pivot选择的不好，使得数组的划分成一个数组只有1个元素，另一个数组拥有剩下的所有元素。考虑到递归调用，空间复杂度为$O(logn)$。java的Arrays类中的sort方法在数组比较小(small array)的时候就使用的快速排序(Dual Pivot Quicksort)，在Dual Pivot Quicksort中，当数组很小(tiny array)的时候使用插入排序。</p>
<p>排序过程</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Sorting_quicksort_anim.gif?attname=&amp;e=1422542413&amp;token=bm0aGge7R2WSvVmK5LOvS5P0w6J5-Dt0_YCJMk1I:Yk4qDNnbxKM2GJMYVhrC-KOkVQI" alt="快速排序"></p>
<p>java代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(T[] array)</span> </span>&#123;</span><br><span class="line">        quickSort(array, <span class="number">0</span>, array.length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(T[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//当数组的个数较少时（比如说10），使用插入排序</span></span><br><span class="line">        <span class="keyword">if</span> (left + <span class="number">10</span> &lt;= right) &#123;</span><br><span class="line">            T pivot = median3(array, left, right);</span><br><span class="line">            <span class="keyword">int</span> i = left, j = right - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (array[++i].compareTo(pivot) &lt; <span class="number">0</span>) &#123;&#125; <span class="comment">//通过median3可以知道第i个元素一定是小于pivot的</span></span><br><span class="line">                <span class="keyword">while</span> (array[--j].compareTo(pivot) &gt; <span class="number">0</span>) &#123;&#125; <span class="comment">//通过median3可以知道第j个元素就是pivot</span></span><br><span class="line">                <span class="keyword">if</span> (i &lt; j) &#123; <span class="comment">// 这里通过上面的两个空的while循环可以知道 如果 i==j ,则array[i]==pivot</span></span><br><span class="line">                    swap(array, i, j);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(array, i, right-<span class="number">1</span>); <span class="comment">// 将pivot放再中间位置</span></span><br><span class="line">            quickSort(array, left, i - <span class="number">1</span>);</span><br><span class="line">            quickSort(array, i+<span class="number">1</span>, right);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            insertionSort(array, left, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//选择pivot</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function">T <span class="title">median3</span><span class="params">(T[] array, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> center = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 比较的顺序！！！</span></span><br><span class="line">        <span class="keyword">if</span> (array[center].compareTo(array[left]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            swap(array, left, center);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (array[left].compareTo(array[right]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            swap(array, left, right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (array[center].compareTo(array[right]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            swap(array, center, right);</span><br><span class="line">        &#125;</span><br><span class="line">        swap(array, center, right-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> array[right-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="计数排序">计数排序</h2><p><a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F" target="_blank" rel="external">计数排序</a></p>
<p>计数排序是通过统计数组中各个值的个数来进行排序的排序算法，不需要进行比较，所以就没有了$O(nlogn)$的时间下限限制。</p>
<p>计数排序首先算出整个待排数组的值的范围，然后统计每个值的个数，接着根据这个来排序。</p>
<p>步骤：</p>
<ol>
<li>找出待排序数组的最大值和最小值</li>
<li>统计数组中每个值i出现的次数，存入数组C[i]中</li>
<li>对数组C进行累加，即C[i] += C[i-1]</li>
<li>反向填充目标数组</li>
</ol>
<p>长度为n的范围在0-k之间的数组，计数排序的时间复杂度是$O(n+k)$，空间复杂度为$O(n+k)$</p>
<h3 id="代码">代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] sort(<span class="keyword">int</span>[] unsorted) &#123;</span><br><span class="line">   <span class="keyword">int</span> max = <span class="number">0</span>, min = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i : unsorted) &#123;</span><br><span class="line">       <span class="keyword">if</span> (i &gt; max) &#123;</span><br><span class="line">           max = i;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (i &lt; min) &#123;</span><br><span class="line">           min = i;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[max - min + <span class="number">1</span>];</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i : unsorted) &#123;</span><br><span class="line">       count[i]++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; count.length; i++) &#123;</span><br><span class="line">       count[i] += count[i - <span class="number">1</span>];</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">int</span>[] sorted = <span class="keyword">new</span> <span class="keyword">int</span>[unsorted.length];</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> val : unsorted) &#123;</span><br><span class="line">       sorted[count[val] - <span class="number">1</span>] = val;</span><br><span class="line">       count[val]--;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> sorted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结">总结</h2><table>
<thead>
<tr>
<th>名称</th>
<th>稳定性</th>
<th>平均时间复杂度</th>
<th>最坏时间复杂度</th>
<th>空间复杂度</th>
</tr>
</thead>
<tbody>
<tr>
<td>冒泡排序</td>
<td>稳定</td>
<td>$O(n^2)$</td>
<td>$O(n^2)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>插入排序</td>
<td>稳定</td>
<td>$O(n^2)$</td>
<td>$O(n^2)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>选择排序</td>
<td>不稳定</td>
<td>$O(n^2)$</td>
<td>$O(n^2)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>归并排序</td>
<td>稳定</td>
<td>$O(nlogn)$</td>
<td>$O(nlogn)$</td>
<td>$O(n)$</td>
</tr>
<tr>
<td>希尔排序</td>
<td>不稳定</td>
<td>$O(nlogn)$</td>
<td>$O(n^i)$1&lt; i&lt;2</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>堆排序</td>
<td>不稳定</td>
<td>$O(nlogn)$</td>
<td>$O(nlogn)$</td>
<td>$O(1)$</td>
</tr>
<tr>
<td>快速排序</td>
<td>不稳定</td>
<td>$O(nlogn)$</td>
<td>$O(n^2)$</td>
<td>$O(logn)$</td>
</tr>
<tr>
<td>计数排序</td>
<td>稳定</td>
<td>$O(n+k)$</td>
<td>$O(n+k)$</td>
<td>$O(n+k)$</td>
</tr>
</tbody>
</table>
]]></content>
    <summary type="html">
    <![CDATA[<p>排序算法总结。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《文法俱乐部》读书笔记之第三章形容词]]></title>
    <link href="http://ztmark.github.io/2016/01/13/%E3%80%8A%E6%96%87%E6%B3%95%E4%BF%B1%E4%B9%90%E9%83%A8%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%AC%AC%E4%B8%89%E7%AB%A0%E5%BD%A2%E5%AE%B9%E8%AF%8D/"/>
    <id>http://ztmark.github.io/2016/01/13/《文法俱乐部》读书笔记之第三章形容词/</id>
    <published>2016-01-12T16:00:00.000Z</published>
    <updated>2016-01-13T06:42:44.000Z</updated>
    <content type="html"><![CDATA[<p>《文法俱乐部》读书笔记.</p>
<a id="more"></a>
<p>形容词是修饰名词专用的。广义的形容词包括形容词子句、减化形容词子句、介系词片语以及单字等等。</p>
<p>单字形状的形容词，通常在句子中只有两种位置可能出现：名词片语中以及补语位置。另外还有一种特别的情况，形容词要放在名词后面当做后位修饰语。</p>
<h2 id="名词片语中的形容词">名词片语中的形容词</h2><p>名词片语中的三个位置：限定词 + 形容词 + 名词。这个位置的形容词，英文称为attributive adjectives，是用来表示该名词属性(attribute)的形容词。</p>
<h3 id="名词转为形容词">名词转为形容词</h3><p>如果名词片语中的形容词位置，放入的却是另一个名词，那么中间这个名词应该视为形容词看待、当做形容词使用。比如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">that flower shop 那家花店</span><br><span class="line">your trouser pockets 你的裤子口袋</span><br><span class="line"><span class="tag">a</span> shoe factory 一个家制鞋工厂</span><br></pre></td></tr></table></figure>
<p>that flower shop这个名词片语中间的形容词位置，放的却是一个名词flower，这时该把flower当做形容词看待。中间用的是单数的flower而不是复数的flowers，因为中间是形容词位置，flower被看做形容词，而形容词是没有复数的，只有名词才可能会有复数，所以是使用单数flower。</p>
<h3 id="复合字形容词">复合字形容词</h3><p>单字形状的形容词才能够放进名词片语中间的位置。如果是个形容词片语，那么名词片语中的位置容纳不下，必须先把形容词片语改造为单字。也就是必须先加上连字符号制造成复合字，才能放入名词片语中，如果原先的形容词片语中有复数名词存在，还得先把-s去掉，因为改造成复合字之后就是个形容词单字、不能采用复数形。例如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">that</span> hard-<span class="keyword">to</span>-solve problem 那个难解的问题</span><br><span class="line">state-<span class="keyword">of</span>-<span class="keyword">the</span>-art technology 尖端科技</span><br><span class="line">a five-<span class="property">year</span>-old boy 一个五岁大的男孩</span><br><span class="line"><span class="keyword">that</span> <span class="number">10</span>-story-high building 那栋十层楼高的建筑</span><br></pre></td></tr></table></figure>
<p>five years old的形容词片语是无法放入a boy中间的，所以必须把形容词片语改造成单字。做法就是用-连接，变成形容词单字之后就不能再有复数，所以要把years后面的s去掉。</p>
<h3 id="复数形的形容词">复数形的形容词</h3><p>一般情况，英文的形容词只有单数没有复数。但也有一些特殊的情况。例如：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">that</span> savings <span class="keyword">bank </span>那家储蓄银行</span><br><span class="line"><span class="label">damages</span> negotiations 赔偿谈判</span><br><span class="line"><span class="keyword">several </span>clothes hangers 几只衣架</span><br><span class="line"><span class="label">your</span> sports car 你的跑车</span><br></pre></td></tr></table></figure>
<p>以that savings bank为例，中间的形容词用的是复数的savings。这是因为『储蓄』通常就是拼成savings的。如果是saving就是『节省』或『挽救』的意思。其他的情况也是类似的，后面加s翻译成特定意思。</p>
<h3 id="名词片语中形容词的顺序">名词片语中形容词的顺序</h3><p>在名词片语中，若有两个以上的形容词单字出现，就会产生顺序的为题。比如</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">two</span> <span class="keyword">big </span>old houses 两栋庞大的老房子</span><br></pre></td></tr></table></figure>
<p>big和old是两个形容词单字，不是一个形容词片语，因为这两个字分别独立来形容houses。</p>
<p>名词片语中的形容词称为attributive adjectives，这种形容词的任务就是要表达这个名词的属性，也就是属于这个名词定义的一部分、不可变的特质。如果这个位置放了两个以上的形容词，那么越是能够表达名词属性的形容词要越靠近名词、也就是越要往后放。换句话说，名词片语中的形容词，它所表达的越是不可变的、客观的特质就越是要靠近名词，反之，越是可变的、临时的、主观的因素则越是要放的离名词远。比如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">He graduated <span class="built_in">from</span> <span class="operator">a</span> prestigious old American law shcool.</span><br><span class="line">他从一家地位崇高、历史悠久的美国法学院毕业。</span><br></pre></td></tr></table></figure>
<p>首先，law也是名词，和school放在一起构成一个复合名词，成为law school，这里law是名词转为形容词使用，并和school共同表示这是『法学院』，所以law可以说是这个名词片语定义中不可或缺的一部分。</p>
<p>其次，American表示这是『美国的』的法学院，相对law来说并没有那么明显属于定义的一部分。而对于前面的几个形容词来说，American至少是不容易改变的属性，而old和prestigious更易变，和定义和属性关系更远。所以要放得离名词更远，就是更前面。而old和prestigious这两个形容词，prestigious『地位崇高的』相比old『老的』更易变。old需要时间的推移慢慢变成历史悠久，而prestigious『地位崇高』很可能因为发生几件丑闻，这家学院的地位就一落千丈了。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I threw away <span class="keyword">that</span> dirty old blue silk necktie.</span><br><span class="line">我扔掉了那条肮脏老旧的蓝色丝领带。</span><br></pre></td></tr></table></figure>
<p>这里silk是名词，也是名词转形容词，和necktie组成复合名词『丝领带』，而blue是在出厂后就已经定下来了不会改变，而old则会慢慢便旧，而dirty就更容易改变了。</p>
<h2 id="补语位置的形容词">补语位置的形容词</h2><p>放在补语位置（包括主词补语与受词补语）的形容词比较自由，单词、片语都可以。补语位置的形容词，英文称为predicative adjective,也就是『做叙述之用的形容词』。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">These flowers smell sweet. 这些花闻起来很香。</span><br><span class="line">S V <span class="keyword">C</span></span><br></pre></td></tr></table></figure>
<p>sweet是形容词单字，放在主词补语位置、修饰主词these flowers。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">That building is <span class="number">18</span> stories tall. 那栋大楼有<span class="number">18</span>层高。</span><br><span class="line">S V C</span><br></pre></td></tr></table></figure>
<p>形容词片语18 stories tall 放在主词补语位置、修饰主词that building。 请注意：形容词片语中可以包含复数名词，所以18 stories用的复数。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">I</span> saw the dog crossing the sreet. 我看到狗在过马路。</span><br><span class="line">S V <span class="keyword">O</span> <span class="keyword">C</span></span><br></pre></td></tr></table></figure>
<p>现在分词片语crossing the street当做形容词片语使用，放在受词补语位置来修饰受词the dog。</p>
<p><strong>一些a-开头的形容词</strong></p>
<p>有些a-开头的形容词，不能放在名词片语中，只能放在补语位置。a-开头的的字带有『暂时性』的意思，所以它不适合放在名词片语中表示『不变属性』的attributive位置，只能放在补语位置去做predicative的叙述。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The patient was asleep. 病人睡着了。</span><br><span class="line">S V <span class="keyword">C</span></span><br></pre></td></tr></table></figure>
<p>asleep表示『暂时处于睡着状态』，所以不适合放在表示属性的名词片语位置，只能放在补语位置去做叙述。</p>
<p>有一些放在补语位置的形容词，本身还不具备完整的意思，需要配合别的文字来做进一步的补充，意思才算完整。配合它来做补充的文字，常见的有不定词片语、介系词片语以及名词子句三种。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I am eager to <span class="operator"><span class="keyword">begin</span> the <span class="keyword">project</span>. 我急着想开始这项计划</span><br><span class="line">S V <span class="keyword">C</span></span></span><br></pre></td></tr></table></figure>
<p>光说说I am eager，补语位置的形容词似乎尚未交代清楚这句话是什么意思，加上了to begin the project，句子才算完整。</p>
<p><strong>总结</strong></p>
<blockquote>
<p>名词片语中形容词叫做attributive adjectives，用来表达该名词的属性。补语位置的形容词叫做predicative adjectives，用来叙述关于名词的种种。补语位置的形容词距离名词最远，用来对名词做一些临时性、补充性的叙述。</p>
</blockquote>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. His brother was sick yesterday <span class="keyword">and</span> could<span class="attribute">'t</span> come <span class="keyword">to</span> work. 他弟弟昨天生病、不能来上班</span><br><span class="line"><span class="number">2</span>. His brother <span class="keyword">is</span> a sick man. 他弟弟是个有病的人</span><br></pre></td></tr></table></figure>
<p>例1中的sick放在补语位置来形容his brother，是用来对his brother做一项叙述，内容可以是很暂时性的。</p>
<p>例2中sick放在名词片语中，来交代属于这个man的一个属性，语气是比较永久性的。</p>
<h2 id="后位修饰的形容词">后位修饰的形容词</h2><p>有些特别的形容词并不放在名词片语中，却要放在名词后面。这种形容词称为后位修饰语。</p>
<h3 id="复合名词后面">复合名词后面</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">I</span> am meeting someone important tonight.</span><br><span class="line">今晚我将和一个重要人物碰面</span><br></pre></td></tr></table></figure>
<p>像someone，anybody这种复合名词，已经把限定词（some，any）和名词（one，body）写在一起合为复合词了，所以，限定词和名词中间那个可以放形容词的位置已经没了，若有形容词就只能放在这种复合名词后面。</p>
<h3 id="a-开头的形容词">a-开头的形容词</h3><p>有些a-开头的形容词除了能放在补语位置，还可以放在名词片语后面。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">Jane</span> <span class="keyword">and</span> her mother alike are teachers.</span><br><span class="line">珍和她妈妈一样都是做老师的</span><br></pre></td></tr></table></figure>
<p>对等连接词and连接Jane和her mother这两个名词片语。形容词alike不能放在名词片语中，但是可以放在名词片语后面。类似的还有these people alone『光是这些人』、wood adrift『漂流的木头』。</p>
<h3 id="外来语与惯用语">外来语与惯用语</h3><p>有些词是外来语，或者是其他的惯用语，这些把形容词放在名词后面。例如：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">the</span> President elect 总统当选人</span><br><span class="line"><span class="label">heir</span> apparent 王位继承人</span><br><span class="line"><span class="label">court</span> <span class="keyword">martial </span>军法审判</span><br><span class="line"><span class="label">Asia</span> Minor 小亚细亚</span><br><span class="line"><span class="label">Secretary</span> General 秘书长</span><br></pre></td></tr></table></figure>
<h2 id="形容词的比较级">形容词的比较级</h2><p>修饰语包括形容词和副词，都有比较级与最高级的变化，形容词的比较级，可以视为『大于、小于、等于』。</p>
<p>大于：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="typename">Unit</span> <span class="number">3</span> <span class="keyword">is</span> longer than <span class="typename">Unit</span> <span class="number">4.</span> 第三课比第四课长。</span><br></pre></td></tr></table></figure>
<p>小于：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="typename">Unit</span> <span class="number">3</span> <span class="keyword">is</span> less difficult than <span class="typename">Unit</span> <span class="number">4.</span> 第三课没第四课难。</span><br></pre></td></tr></table></figure>
<p>等于：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="typename">Unit</span> <span class="number">4</span> <span class="keyword">is</span> <span class="keyword">as</span> boring <span class="keyword">as</span> <span class="typename">Unit</span> <span class="number">3.</span> 第四课和第三课一样无聊。</span><br></pre></td></tr></table></figure>
<h3 id="比较级的拼法">比较级的拼法</h3><p>单音节的形容词因为很短，适合在字尾变化（如：tall, taller, tallest）,而三个音节以上的形容词已经很长了，不适合再加字尾变化，因而分成两个字来处理（如：expensive, more expensive, most expensive）</p>
<p>两个音节的形容词，如果字尾是典型的形容词字尾，有明显的标识词类的功能，应保留字尾不变，分成两个字处理。如果不是典型的形容词字尾，那么可以选择在前面加more，most，也可以选择在字尾加-er,-est。</p>
<p>例如：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">helpful <span class="built_in">more</span> helpful most helpful</span><br><span class="line">useless <span class="built_in">more</span> useless most useless</span><br><span class="line">famous <span class="built_in">more</span> famous most  famous</span><br><span class="line">active <span class="built_in">more</span> active most active</span><br><span class="line">crowded <span class="built_in">more</span> crowded most crowded</span><br><span class="line">looving <span class="built_in">more</span> loving most loving</span><br></pre></td></tr></table></figure>
<p>这些两个音节的字都是典型的形容词字尾（-ful,-less,-ous）,应该分成两个字处理。其他双音节形容词，如果不是典型的形容词字尾，变化则无限制。</p>
<p>如果双音节形容词是以-y结尾的，这个长母音因为发音上的要求，一般要先变为短母音的i，再加上字尾变化如：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">happy</span> happier happiest</span><br><span class="line">lucky luckier luckiest</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>只有双音节的形容词、不长不短，才需要去看字尾。如果是单音节、或是三个音节以上的，并不需要看字尾。</p>
<h3 id="定冠词的判断">定冠词的判断</h3><p>冠词是属于限定词类，是名词片语的一部分，应该跟着名词走，如果是补语位置的形容词，并不是放在名词片语中，自然就没有冠词的问题。</p>
<h3 id="that和those的使用">that和those的使用</h3><p>比较级要求对称工整，也就是『谁和谁比』不能搞错。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">My car <span class="keyword">is</span> bigger than you. (误)</span><br><span class="line">My car <span class="keyword">is</span> bigger than yours. 我的车比你的大。</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>《文法俱乐部》读书笔记.</p>]]>
    
    </summary>
    
      <category term="English" scheme="http://ztmark.github.io/tags/English/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Mybatis时遇到的一个问题]]></title>
    <link href="http://ztmark.github.io/2016/01/01/%E4%BD%BF%E7%94%A8Mybatis%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/"/>
    <id>http://ztmark.github.io/2016/01/01/使用Mybatis时遇到的一个问题/</id>
    <published>2015-12-31T16:00:00.000Z</published>
    <updated>2016-01-01T13:26:10.000Z</updated>
    <content type="html"><![CDATA[<p>使用Mybatis时遇到的一个奇怪的问题。</p>
<a id="more"></a>
<p>在使用Mybatis的时候出现了如下问题：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org<span class="class">.apache</span><span class="class">.ibatis</span><span class="class">.binding</span><span class="class">.BindingException</span>: Invalid bound statement (not found)</span><br></pre></td></tr></table></figure>
<p>出现这个一般都是Mapper的XML文件和Mapper的接口文件没有对应上。</p>
<p>但是我仔细看了很久都没发现哪里出错了，网上也看了各种解决办法，也都没什么收获，我的用法都是正确的。</p>
<p>最后我到命令行下看了一下Mapper的XML文件的所在路径后发现了问题所在。</p>
<p>这些XML文件的路径是在<code>resources/com.mark.dao</code>文件夹下而不是<code>resources/com/mark/dao</code>文件夹下。</p>
<p>原来我在用IDE在resources下创建文件夹的时候，输入文件夹名的时候我习惯性的和创建包名一样直接写了<code>com.mark.dao</code>，所以创建出来的文件夹是<code>com.mark.dao</code>而不是<code>com/mark/dao</code>。由于我在IDE中的Project View设置了compact empty midlle package项，导致这两者在IDE很难看出区别来。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>使用Mybatis时遇到的一个奇怪的问题。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java中的IO流四]]></title>
    <link href="http://ztmark.github.io/2015/12/25/Java%E4%B8%AD%E7%9A%84IO%E6%B5%81%E5%9B%9B/"/>
    <id>http://ztmark.github.io/2015/12/25/Java中的IO流四/</id>
    <published>2015-12-24T16:00:00.000Z</published>
    <updated>2015-12-25T07:25:04.000Z</updated>
    <content type="html"><![CDATA[<p>Java的IO相关内容。</p>
<a id="more"></a>
<h2 id="NIO2">NIO2</h2><h3 id="文件系统访问">文件系统访问</h3><p>java.nio.file.Path类用来表示一个路径。该类有许多路径相关的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	Path path = Paths.get(<span class="string">"/Users/Mark/Project"</span>, <span class="string">"Base.java"</span>);</span><br><span class="line">   System.out.println(path); <span class="comment">// /Users/Mark/Project/Base.java</span></span><br><span class="line">   System.out.println(path.toAbsolutePath()); <span class="comment">// /Users/Mark/Project/Base.java</span></span><br><span class="line">   System.out.println(path.toRealPath()); <span class="comment">// /Users/Mark/Project/Base.java</span></span><br><span class="line">   System.out.println(path.getFileName()); <span class="comment">// Base.java</span></span><br><span class="line">   System.out.println(path.getNameCount()); <span class="comment">// 4</span></span><br><span class="line">   System.out.println(path.getRoot()); <span class="comment">// /</span></span><br><span class="line">   System.out.println(path.getParent()); <span class="comment">// /Users/Mark/Project</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; path.getNameCount(); i++) &#123;</span><br><span class="line">       System.out.println(path.getName(i)); <span class="comment">// Users, Mark, Project, Base.java</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//==================================</span></span><br><span class="line">	path = Paths.get(<span class="string">"src/main/java/"</span>, <span class="string">"com/mark/nio"</span>);</span><br><span class="line">	System.out.println(path); <span class="comment">// src/main/java/com/mark/nio</span></span><br><span class="line">	System.out.println(path.subpath(<span class="number">0</span>, <span class="number">3</span>)); <span class="comment">// src/main/java</span></span><br><span class="line">	</span><br><span class="line">	System.out.println(path.resolve(<span class="string">"test"</span>)); <span class="comment">// src/main/java/com/mark/nio/test</span></span><br><span class="line">	System.out.println(path.resolveSibling(<span class="string">"io"</span>)); <span class="comment">// src/main/java/com/mark/io</span></span><br><span class="line">	</span><br><span class="line">	Path other = Paths.get(<span class="string">"src/main/resources"</span>); </span><br><span class="line">	System.out.println(other.toAbsolutePath());  <span class="comment">// /Users/Mark/Project/idea/javademo/src/main/resources</span></span><br><span class="line">	path = path.relativize(other); </span><br><span class="line">	System.out.println(path); <span class="comment">// ../../../../resources</span></span><br><span class="line">	System.out.println(path.toAbsolutePath()); <span class="comment">// /Users/Mark/Project/idea/javademo/../../../../resources</span></span><br><span class="line">	System.out.println(path.toAbsolutePath().normalize()); <span class="comment">// /Users/resources</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>列出目录的子目录和文件可以使用File.list和File.listFiles方法，NIO2中可以使用java.nio.file.DirectoryStream来进行遍历目录。DirectoryStream接口实现了Closeable和Iterable接口。通过Files.newDirectoryStream方法获得DirectoryStream实例，可以通过DirectoryStream.Filter来过滤。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">""</span>);</span><br><span class="line">DirectoryStream&lt;Path&gt; ds = Files.newDirectoryStream(path, <span class="string">"*.java"</span>); <span class="comment">// 只会列出当前目录下的文件和子目录，不会递归列出子目录下的文件和目录</span></span><br><span class="line"><span class="keyword">for</span> (Path d : ds) &#123;</span><br><span class="line">  System.out.println(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果想递归遍历整个目录，可以使用Files.walkFileTree方法和java.nio.file.FileVisitor接口。FileVisitor接口有四个方法</p>
<ul>
<li>visitFile  正在访问某个文件</li>
<li>visitFileFailed 访问某个文件出现错误</li>
<li>preVisitDirectory 在访问一个目录中的子目录和文件之前调用</li>
<li>postVisitDirectory 在访问一个目录中的子目录和文件之后调用</li>
</ul>
<p>这四个方法都返回FileVisitResult，这是一个枚举类型，有四个值CONTINUE、TERMINATE、SKIP_SUBTREE 和 SKIP_SIBLINGS。<br>该接口有一个默认实现SimpleFileVisitor。我们可以继承这个类来实现我们自己的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 列出当前目录下的所有Java文件</span></span><br><span class="line">Path start = Paths.get(<span class="string">""</span>);</span><br><span class="line">   Files.walkFileTree(start, <span class="keyword">new</span> SimpleFileVisitor&lt;Path&gt;() &#123;</span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">visitFile</span><span class="params">(Path file, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (file.getFileName().toString().endsWith(<span class="string">".java"</span>)) &#123;</span><br><span class="line">               System.out.println(file.toAbsolutePath());</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">preVisitDirectory</span><span class="params">(Path dir, BasicFileAttributes attrs)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">       		<span class="comment">// 跳过 .git 和 .idea 目录</span></span><br><span class="line">           <span class="keyword">if</span> (<span class="string">".git"</span>.equals(dir.getFileName().toString()) || <span class="string">".idea"</span>.equals(dir.getFileName().toString())) &#123;</span><br><span class="line">               <span class="keyword">return</span> FileVisitResult.SKIP_SUBTREE;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> FileVisitResult.CONTINUE;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">visitFileFailed</span><span class="params">(Path file, IOException exc)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">super</span>.visitFileFailed(file, exc);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> FileVisitResult <span class="title">postVisitDirectory</span><span class="params">(Path dir, IOException exc)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">super</span>.postVisitDirectory(dir, exc);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>
<p>文件的属性信息由java.nio.file.attribute.BasicFileAttributes、PosixFileAttributes、DosFileAttributes这几个接口定义。可以通过java.nio.file.attribute.BasicFileAttributeView、DosFileAttributeView、PosixFileAttributeView的readAttributes方法来得到。Files类也提供了一系列静态方法来获得文件的属性信息。不同类型的FileAttributes会有不同的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">"pom.xml"</span>);</span><br><span class="line">PosixFileAttributeView fav = Files.getFileAttributeView(path, PosixFileAttributeView.class);</span><br><span class="line">PosixFileAttributes attributes = fav.readAttributes();</span><br><span class="line">System.out.println(attributes.group());</span><br><span class="line">System.out.println(attributes.owner());</span><br><span class="line">System.out.println(attributes.permissions());</span><br><span class="line">System.out.println(attributes.creationTime());</span><br><span class="line">System.out.println(attributes.isRegularFile());</span><br><span class="line">System.out.println(attributes.lastAccessTime());</span><br><span class="line">System.out.println(attributes.lastModifiedTime());</span><br><span class="line">System.out.println(attributes.size());</span><br></pre></td></tr></table></figure>
<p>对一个目录进行监视可以通过java.nio.file.WatchService接口来实现，通过将要监视的目录和感兴趣的事件注册到WatchService，事件类StandardWatchEventKinds中定义了一些事件，在事件发生的时候就可以通过WatchKey来获得事件列表。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Path this_dir = Paths.get(<span class="string">""</span>).toAbsolutePath();</span><br><span class="line">   System.out.println(<span class="string">"Now watching the current directory "</span> + this_dir.toString());</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       WatchService watcher = this_dir.getFileSystem().newWatchService();</span><br><span class="line">       this_dir.register(watcher, StandardWatchEventKinds.ENTRY_CREATE);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           WatchKey watchKey = watcher.take();</span><br><span class="line">           List&lt;WatchEvent&lt;?&gt;&gt; events = watchKey.pollEvents();</span><br><span class="line">           <span class="keyword">for</span> (WatchEvent event : events) &#123;</span><br><span class="line">               Path context = (Path) event.context(); <span class="comment">// 返回的是相对于监视目录的相对路径</span></span><br><span class="line">               context = this_dir.resolve(context); <span class="comment">// 转成绝对路径</span></span><br><span class="line">               System.out.println(<span class="string">"Someone just created the file "</span> + context.toString());</span><br><span class="line">               System.out.println(Files.size(context));</span><br><span class="line">           &#125;</span><br><span class="line">           watchKey.reset(); <span class="comment">// 不重置的话,之后相同的事件就无法被监视到</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">       System.out.println(<span class="string">"Error: "</span> + e.toString());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="zip/jar文件系统">zip/jar文件系统</h3><p>在Java中可以通过FileSystem和FileSystemProvider这两个抽象类来实现自定义的文件系统。</p>
<p>Java类库中包含两种文件系统，基于操作系统的文件系统和zip/jar文件系统。</p>
<p>例子：将一个文件添加到zip压缩包中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   File testZip = <span class="keyword">new</span> File(<span class="string">"归档.zip"</span>);</span><br><span class="line">   File fileToAdd = <span class="keyword">new</span> File(<span class="string">"demo.txt"</span>);</span><br><span class="line">   <span class="keyword">if</span> (testZip.exists() &amp;&amp; fileToAdd.exists()) &#123;</span><br><span class="line">       addFile(testZip, fileToAdd);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line">原先的方法：</span><br><span class="line">先创建一个tmp文件,然后将原压缩文件中的数据写入tmp文件,再把要加入的文件数据写入tmp文件</span><br><span class="line">最后删了原压缩文件,并把tmp文件改名为原压缩文件</span><br><span class="line">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addFile</span><span class="params">(File zip, File file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   File tmp = File.createTempFile(zip.getName(), <span class="keyword">null</span>);</span><br><span class="line">   <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">try</span> (ZipInputStream input = <span class="keyword">new</span> ZipInputStream(<span class="keyword">new</span> FileInputStream(zip));</span><br><span class="line">       ZipOutputStream output = <span class="keyword">new</span> ZipOutputStream(<span class="keyword">new</span> FileOutputStream(tmp))) &#123;</span><br><span class="line">       ZipEntry entry = input.getNextEntry();</span><br><span class="line">       <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">10240</span>];</span><br><span class="line">       <span class="keyword">while</span> (entry != <span class="keyword">null</span>) &#123;</span><br><span class="line">           String name = entry.getName();</span><br><span class="line">           <span class="keyword">if</span> (!file.getName().equals(name)) &#123;</span><br><span class="line">               output.putNextEntry(<span class="keyword">new</span> ZipEntry(name));</span><br><span class="line">               <span class="keyword">while</span> ((len = input.read(buf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                   output.write(buf, <span class="number">0</span>, len);</span><br><span class="line">               &#125;</span><br><span class="line">               output.closeEntry();</span><br><span class="line">           &#125;</span><br><span class="line">           entry = input.getNextEntry();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> (FileInputStream newFileInput = <span class="keyword">new</span> FileInputStream(file)) &#123;</span><br><span class="line">           output.putNextEntry(<span class="keyword">new</span> ZipEntry(file.getName()));</span><br><span class="line">           System.out.println(newFileInput.available());</span><br><span class="line">           <span class="keyword">while</span> ((len = newFileInput.read(buf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">               output.write(buf, <span class="number">0</span>, len);</span><br><span class="line">           &#125;</span><br><span class="line">           output.closeEntry();</span><br><span class="line">       &#125;</span><br><span class="line">       zip.delete();</span><br><span class="line">       tmp.renameTo(zip);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用文件系统的方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addFileToZip</span><span class="params">(File zip, File file)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   Map&lt;String, String&gt; env = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">   env.put(<span class="string">"create"</span>, <span class="string">"true"</span>);</span><br><span class="line">   <span class="comment">// 这里的URI.create的参数是固定的 jar:+文件的URI</span></span><br><span class="line">   <span class="comment">// jar是jar文件系统的Scheme</span></span><br><span class="line">   <span class="comment">// 在操作压缩文件时,需要通过Paths.get(URI)方法来得到压缩文件</span></span><br><span class="line">   <span class="keyword">try</span> (FileSystem fs = FileSystems.newFileSystem(URI.create(<span class="string">"jar:"</span> + zip.toURI()), env)) &#123;</span><br><span class="line">       Path path = file.toPath();</span><br><span class="line">       Path pathInZip = fs.getPath(<span class="string">"/test/"</span> + file.getName());<span class="comment">// 指定压缩文件中的位置,这里是压缩文件中的test文件夹下</span></span><br><span class="line">       Files.copy(path, pathInZip, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="异步I/O通道">异步I/O通道</h3><p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">server</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   AsynchronousChannelGroup group = AsynchronousChannelGroup.withFixedThreadPool(<span class="number">10</span>, Executors.defaultThreadFactory());</span><br><span class="line">   AsynchronousServerSocketChannel channel = AsynchronousServerSocketChannel.open(group).bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8680</span>));</span><br><span class="line">   channel.accept(<span class="keyword">null</span>, <span class="keyword">new</span> CompletionHandler&lt;AsynchronousSocketChannel, Void&gt;() &#123;</span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(AsynchronousSocketChannel result, Void attachment)</span> </span>&#123;</span><br><span class="line">       	   channel.accept(<span class="keyword">null</span>, <span class="keyword">this</span>);</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               System.out.println(result.getRemoteAddress());</span><br><span class="line">               result.write(ByteBuffer.wrap(<span class="string">"hi there!"</span>.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">               result.close();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="annotation">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, Void attachment)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(exc);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">   AsynchronousFileChannel afc = AsynchronousFileChannel.open(Paths.get(<span class="string">"demo.txt"</span>), StandardOpenOption.CREATE, StandardOpenOption.WRITE);</span><br><span class="line">   Future&lt;Integer&gt; future = afc.write(ByteBuffer.wrap(<span class="string">"hello world"</span>.getBytes()), <span class="number">0</span>);</span><br><span class="line">   System.out.println(future.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AsynchronousServerSocketChannel实现了NetworkChannel接口，该接口是是与网络套接字相关的通道，提供了绑定和配置相关的方法。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Java的IO相关内容。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java中的IO流三]]></title>
    <link href="http://ztmark.github.io/2015/12/22/Java%E4%B8%AD%E7%9A%84IO%E6%B5%81%E4%B8%89/"/>
    <id>http://ztmark.github.io/2015/12/22/Java中的IO流三/</id>
    <published>2015-12-21T16:00:00.000Z</published>
    <updated>2015-12-22T10:48:53.000Z</updated>
    <content type="html"><![CDATA[<p>Java的IO相关内容。</p>
<a id="more"></a>
<h2 id="通道">通道</h2><p>Java的NIO中的通道都实现了java.nio.channels.Channel接口，Channel接口只有两个方法isOpen()和close()方法，close()方法是AutoCloseable接口中的方法。</p>
<p>支持读操作的Channel可以实现ReadableByteChannel接口，该接口只有一个read方法，支持写操作的Channel可以实现WritableByteChannel接口，该接口只有一个write方法，支持读写操作以外的一些移动读写的Channel可以实现SeekableByteChannel，该接口有一些移动读取的方法。</p>
<p>ReadableByteChannel接口的子接口ScatteringByteChannel提供了不同的read方法，使用一个ByteBuffer数组的read方法，将通道的数据读到多个ByteBuffer中。</p>
<p>WritableByteChannel接口的子接口GatheringByteChannel提供了不同write方法，使用多个ByteBuffer，将多个ByteBuffer的数据写入通道。</p>
<h3 id="文件通道">文件通道</h3><p>FileChannel实现了SeekableByteChannel, GatheringByteChannel, ScatteringByteChannel接口，而且提供了一些文件操作相关的功能。</p>
<p>FileChannel可以通过open方法来创建，创建的时候可以传入OpenOption参数，StandardOpenOption枚举类定义了一些操作参数。</p>
<p>FileChannel也可以从已有的FileInputStream、FileOutputStream和RandomAccessFile类的对象中通过getChannel方法得到。</p>
<p>FileChannel的transferFrom和transferTo两个方法可以实现数据传输。</p>
<h4 id="内存映射文件">内存映射文件</h4><p>在操作大文件的时候可以通过内存映射文件将大文件映射到内存，这样，可以直接通过内存操作来操作文件。</p>
<p>FileChannel类的map方法可以把一个文件的全部或部分内容映射到内存中，所得到的是一个ByteBuffer类的子类MappedByteBuffer的对象，程序只要对这个MappedByteBuffer类的对象进行操作即可。对该对象的修改会自动同步到文件中。</p>
<p>在进行内存映射的时候需要指定映射模式，一共有3种映射模式，定义在FileChannel.MapMode类中。</p>
<ul>
<li>READ_ONLY : 只能对映射后的MappedByteBuffer对象进行读操作</li>
<li>READ_WRITE : 可以对映射后的MappedByteBuffer对象进行读写操作</li>
<li>PRIVATE : 对映射后的MappedByteBuffer对象进行的操作不会同步到文件中</li>
</ul>
<p>FileChannel的force方法可以强制要求把更新同步到文件中。</p>
<h4 id="文件锁定">文件锁定</h4><p>FileChannel的lock和tryLock方法可以将当前文件通道对应的文件进行加锁，加锁可以锁定全部内容，也可以锁定部分内容。</p>
<p>文件加锁是用来与操作系统上的其他程序进行同步使用的。</p>
<h3 id="套接字通道">套接字通道</h3><p>java.nio.channels.NetworkChannel接口表示的是一个套接字对应的通道。</p>
<p>相对于Socket和ServerSocket类，Java NIO也提供了SocketChannel和ServerSocketChannel类。这两个都支持阻塞和非阻塞两种模式。</p>
<h4 id="阻塞">阻塞</h4><p>例子：</p>
<p>客户端套接字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadWebPageUseSocket</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   <span class="keyword">try</span> (FileChannel dest = FileChannel.open(Paths.get(<span class="string">"pages.html"</span>), StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class="line">       SocketChannel channel = SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">"www.baidu.com"</span>, <span class="number">80</span>))) &#123;</span><br><span class="line">       String request = <span class="string">"GET / HTTP/1.1\r\n\r\nHost:www.baidu.com\r\n\r\n"</span>;</span><br><span class="line">       ByteBuffer bb = ByteBuffer.wrap(request.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">       channel.write(bb);</span><br><span class="line">       dest.transferFrom(channel, <span class="number">0</span>, Integer.MAX_VALUE);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务端套接字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startSimpleServer</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">   ServerSocketChannel server = ServerSocketChannel.open();</span><br><span class="line">   server.bind(<span class="keyword">new</span> InetSocketAddress(<span class="string">"localhost"</span>, <span class="number">8680</span>));</span><br><span class="line">   <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">       <span class="keyword">try</span> (SocketChannel channel = server.accept()) &#123;</span><br><span class="line">           channel.write(ByteBuffer.wrap(<span class="string">"hello there"</span>.getBytes(StandardCharsets.UTF_8)));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="非阻塞">非阻塞</h4><p> 例子：</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardOpenOption;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadWebPageUseSelector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">load</span><span class="params">(Set&lt;URL&gt; urls)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Map&lt;SocketAddress, String&gt; mapping = urlToSocketAddress(urls);</span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        <span class="keyword">for</span> (SocketAddress socketAddress : mapping.keySet()) &#123;</span><br><span class="line">            register(selector, socketAddress);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> finished = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> total = mapping.size();</span><br><span class="line">        ByteBuffer bb = ByteBuffer.allocate(<span class="number">10240</span>);</span><br><span class="line">        <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (finished &lt; total) &#123;</span><br><span class="line">            <span class="keyword">for</span> (SelectionKey key : selector.selectedKeys()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isReadable()) &#123;</span><br><span class="line">                    SocketChannel channel = (SocketChannel) key.channel();</span><br><span class="line">                    InetSocketAddress address = (InetSocketAddress) channel.getRemoteAddress();</span><br><span class="line">                    FileChannel fileChannel = FileChannel.open(Paths.get(address.getHostName() + <span class="string">".html"</span>), StandardOpenOption.APPEND, StandardOpenOption.CREATE);</span><br><span class="line">                    bb.clear();</span><br><span class="line">                    <span class="keyword">while</span> ((len = channel.read(bb)) &gt; <span class="number">0</span> || bb.position() != <span class="number">0</span>) &#123;</span><br><span class="line">                        bb.flip();</span><br><span class="line">                        fileChannel.write(bb);</span><br><span class="line">                        bb.compact();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                        finished++;</span><br><span class="line">                        key.cancel();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isValid() &amp;&amp; key.isConnectable()) &#123;</span><br><span class="line">                    SocketChannel channel = (SocketChannel) key.channel();</span><br><span class="line">                    <span class="keyword">boolean</span> success = channel.finishConnect();</span><br><span class="line">                    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">                        finished++;</span><br><span class="line">                        key.cancel();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        InetSocketAddress address = (InetSocketAddress) channel.getRemoteAddress();</span><br><span class="line">                        String path = mapping.get(address);</span><br><span class="line">                        String request = <span class="string">"GET "</span> + path + <span class="string">" HTTP/1.1\r\n\r\nHost:"</span> + address.getHostString() + <span class="string">"\r\n"</span>;</span><br><span class="line">                        ByteBuffer header = ByteBuffer.wrap(request.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">                        channel.write(header);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Selector selector, SocketAddress socketAddress)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel channel = SocketChannel.open();</span><br><span class="line">        channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        channel.connect(socketAddress);</span><br><span class="line">        channel.register(selector, SelectionKey.OP_CONNECT|SelectionKey.OP_READ);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;SocketAddress, String&gt; urlToSocketAddress(Set&lt;URL&gt; urls) &#123;</span><br><span class="line">        Map&lt;SocketAddress, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (URL url : urls) &#123;</span><br><span class="line">            <span class="keyword">int</span> port = url.getPort() != -<span class="number">1</span> ? url.getPort() : url.getDefaultPort();</span><br><span class="line">            SocketAddress address = <span class="keyword">new</span> InetSocketAddress(url.getHost(), port);</span><br><span class="line">            String path = url.getPath();</span><br><span class="line">            <span class="keyword">if</span> (url.getQuery() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                path = path + <span class="string">"?"</span> + url.getQuery();</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(address, path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Java的IO相关内容。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java中的IO流二]]></title>
    <link href="http://ztmark.github.io/2015/12/16/Java%E4%B8%AD%E7%9A%84IO%E6%B5%81%E4%BA%8C/"/>
    <id>http://ztmark.github.io/2015/12/16/Java中的IO流二/</id>
    <published>2015-12-15T16:00:00.000Z</published>
    <updated>2015-12-16T10:52:39.000Z</updated>
    <content type="html"><![CDATA[<p>Java的IO相关内容。</p>
<a id="more"></a>
<h2 id="缓冲区">缓冲区</h2><p>java.nio包下面定义了一些缓存区类，基类是Buffer类，是一个抽象类。缓存区有3个状态变量，position、limit和capacity，position是指读写头的位置，limit是指读写头能够读到或写到的位置，capacity是指缓冲区的大小，缓冲区也是支持做标记，所以也有一个mark的变量，它们的关系是mark &lt;= position &lt;= limit &lt;= capacity，mark大于position时，mark就会失效。</p>
<h3 id="Buffer">Buffer</h3><p>Buffer的子类都会提供两种get方法和put方法用来对缓冲区进行操作，Buffer自己提供了基本的对缓冲区状态的查询和设置操作，缓冲区的capacity是在构造的时候给定的，之后就无法修改，其他的都可以设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flip() <span class="comment">// limit = position;position = 0;mark = -1; 翻转操作，之前往缓存写，现在可以读取之前写入的数据；之前是从缓存里读，现在可以写入覆盖之前的数据</span></span><br><span class="line">hasRemaining() <span class="comment">// position &lt; limit 是否还有数据可读</span></span><br><span class="line">remaining() <span class="comment">// limit - position 可读数据个数</span></span><br><span class="line">rewind() <span class="comment">// position = 0;mark = -1; 可以重读或者重写</span></span><br><span class="line">clear() <span class="comment">// 清空缓存区</span></span><br></pre></td></tr></table></figure>
<h3 id="Buffer子类">Buffer子类</h3><p>Buffer有一些针对基本数据类型的缓冲区子类：ByteBuffer,CharBuffer,ShortBuffer,IntBuffer,LongBuffer,FloatBuffer,DoubleBuffer。这些都又类似的方法，一些put个get方法，这些方法都是操作对应的基本数据类型。而ByteBuffer有针对其他基本数据类型的方法，ByteBuffer是直接操作字节的，所以ByteOrder对其是有影响的，ByteOrder有两个常量，BIG_EDIAN和LITTLE_EDIAN。大端表示字节的高位在前，小端表示字节的地位在前，ByteBuffer有对应的asXXXBuffer()方法来将ByteBuffer转换成其他Buffer。</p>
<p>Buffer的子类的一些方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">allocate(capacity) <span class="comment">// 创建一个指定容量的缓冲区</span></span><br><span class="line">wrap(array) <span class="comment">// 通过对应的数组来创建缓冲区</span></span><br><span class="line">compact() <span class="comment">// 压缩，将未读的数据移到缓冲区的前面，position=remain，limit=capacity</span></span><br><span class="line">duplicate() <span class="comment">// 复制一个缓冲区对象，共享同一个缓冲区，各自管理各自的position,limit</span></span><br><span class="line">slice() <span class="comment">// 使用未读数据来创建一个缓冲区对象，共享同一个缓冲区，新缓冲区的position=0，capacity和limit=原缓冲区的remain</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Java的IO相关内容。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java中的IO流一]]></title>
    <link href="http://ztmark.github.io/2015/12/15/Java%E4%B8%AD%E7%9A%84IO%E6%B5%81%E4%B8%80/"/>
    <id>http://ztmark.github.io/2015/12/15/Java中的IO流一/</id>
    <published>2015-12-14T16:00:00.000Z</published>
    <updated>2015-12-15T13:40:01.000Z</updated>
    <content type="html"><![CDATA[<p>Java的IO相关内容。</p>
<a id="more"></a>
<p>所有的流都实现了Closeable接口，所有流都又close方法，下面就不提close方法了。</p>
<h2 id="字节流">字节流</h2><p>最基础就是InputStream和OutputStream，这两个都是抽象类。</p>
<h3 id="InputStream/OutputStream">InputStream/OutputStream</h3><p>最主要的就的read方法，它有三个重载方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="comment">// 读取一个字节，返回读取的字节数据 抽象方法，需子类实现</span></span><br><span class="line"><span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span> b[])</span> <span class="comment">// 读取b.length个字节并放入b数组中，返回实际读取的字节数</span></span><br><span class="line"><span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span> b[],<span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> <span class="comment">// 读取len个自己放入数组b的off开始的位置，返回实际读取的字节</span></span></span><br></pre></td></tr></table></figure>
<p>其他的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">available</span><span class="params">()</span> <span class="comment">// 流中还有多少可以读取的数据，返回字节个数</span></span><br><span class="line"><span class="title">mark</span><span class="params">(<span class="keyword">int</span>)</span> <span class="comment">// 做标记，reset后，流读取头会回到这个地方可以重读后面的数据，参数是可重读的最大字节数</span></span><br><span class="line"><span class="keyword">boolean</span> <span class="title">markSupported</span><span class="params">()</span> <span class="comment">// 流是否支持做标记</span></span><br><span class="line"><span class="title">reset</span><span class="params">()</span> <span class="comment">// 重置，见上面的mark方法</span></span><br><span class="line"><span class="keyword">long</span> <span class="title">skip</span><span class="params">(<span class="keyword">long</span>)</span> <span class="comment">// 跳过指定个数的字节数据</span></span></span><br></pre></td></tr></table></figure>
<h3 id="OutputStream">OutputStream</h3><p>OutputStream只有下面几个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flush() <span class="comment">// 将缓存中的数据写入的磁盘</span></span><br><span class="line">write(<span class="keyword">int</span> b) <span class="comment">// 写入一个字节数据</span></span><br><span class="line">write(<span class="keyword">byte</span> b[]) <span class="comment">// 写入b.length个字节数据</span></span><br><span class="line">write(<span class="keyword">byte</span> b[] <span class="keyword">int</span> off, <span class="keyword">int</span> len) <span class="comment">// 写入数组b的off开始的len个自己数据</span></span><br></pre></td></tr></table></figure>
<h3 id="InputStream和OutputStream的增强">InputStream和OutputStream的增强</h3><p>InputStream是非常基本的输入流，为了能提供一些其他的特性，IO包中还其他的流。</p>
<p>BufferedInputStream和BufferedOutputStream是提供内部缓冲区的流，以此可以提高性能，并支持标记和重置。其构造函数需要一个InputStream/OutputStream作为参数。</p>
<p>DataInputStream和DataOutputStream提供了对读取和写入Java基本数据类的支持。</p>
<p>ObjectInputStream和ObjectOutputStream提供了对Java对象的读写的支持。</p>
<p>PushbackInputStream能将一个或多个已经读取的字节数据放回流中。</p>
<h3 id="其他输入输出流">其他输入输出流</h3><p>FileInputStream和FileOutputStream是文件读取的相关流。</p>
<p>ByteArrayInputStream和ByteArrayOutputStream是和字节数组相关的流。</p>
<p>PipedInputStream和PipedOutputStream是管道流，两个类连接起来后，通过PipedOutputStream写入的数据可以让PipedInputStream读取到。</p>
<p>SequenceInputStream可以将多个输入流按顺序连接起来，形成一个完整的输入流，该流会按顺序依次读取多个流中的数据。</p>
<h2 id="字符流">字符流</h2><p>基本的字符流就是Reader和Writer，它们也都是抽象类。</p>
<p>字符流和字节流其实类似，只是一个是对字符进行处理，一个是对字节进行处理，两种都有类似的类。</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Reader.png" alt=""></p>
<p>Reader和其子类需要借助InputStreamReader使用InputStream来构造。</p>
<p><img src="http://7u2r8z.com1.z0.glb.clouddn.com/Writer.png" alt=""></p>
<p>Writer和其子类需要借助OutputStreamWriter使用OutputStream来构造。</p>
<p>字符流需要注意的一点就是字符编码，在创建InputStreamReader和OutputStreamWriter的时候最好指定编码。<code>Charset.forName(charsetName)</code>可以创建一个给定名字的编码，或者使用<code>StandardCharsets</code>中的几个编码。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Java的IO相关内容。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《文法俱乐部》读书笔记第二章名词片语]]></title>
    <link href="http://ztmark.github.io/2015/12/14/%E3%80%8A%E6%96%87%E6%B3%95%E4%BF%B1%E4%B9%90%E9%83%A8%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%AC%AC%E4%BA%8C%E7%AB%A0%E5%90%8D%E8%AF%8D%E7%89%87%E8%AF%AD/"/>
    <id>http://ztmark.github.io/2015/12/14/《文法俱乐部》读书笔记之第二章名词片语/</id>
    <published>2015-12-13T16:00:00.000Z</published>
    <updated>2015-12-14T07:03:32.000Z</updated>
    <content type="html"><![CDATA[<p>《文法俱乐部》读书笔记.</p>
<a id="more"></a>
<h2 id="名词片语的构造">名词片语的构造</h2><p>英文用字尾变化来表示单、复数。名词片语中还有一些符号来配合标识该名词的范围，通常出现在名词片语的开头位置（也又放在名词片语结尾的），这种符号称为『限定词』（Determiners）。它与名词字尾的单复数符号相呼应，共同『限定』（determine）名词的范围。</p>
<p>名词片语由三个部分构成：限定词 + 形容词 + 名词，这三个部分每一部分都可能省略。形容词还可以依附一个副词来修饰形容词。在写作的时候最好要有这样的认定：英文句子中凡是用到名词，一定是以名词片语的形态出现，也就是一定有三个部分：限定词 + 形容词 + 名词。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">a</span> good teacher 一位好老师</span><br><span class="line">some troublesome students 几个问题学生</span><br><span class="line">their very pretty garden 他们那座非常漂亮的花园</span><br><span class="line">these juicy Japanese apple 这些多汁的日本苹果</span><br></pre></td></tr></table></figure>
<p>这些名词片语都由三个部分构成。第三句是带有副词，very属于加强语气的副词（intensifier），这里用来修饰pretty。最后一句带有两个形容词，可见，名词片语中间的形容词部分可以放多个形容词。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Of all <span class="keyword">the</span> kids <span class="keyword">in</span> <span class="keyword">my</span> <span class="type">class</span>, Jack <span class="keyword">is</span> <span class="keyword">the</span> smartest. 在我的班上所有的小孩当中，杰克是最聪明的</span><br></pre></td></tr></table></figure>
<p>这一句中读者可以从上下文中了解the smartest 就是the smartest kid的省略。所以名词也是可以忽略。但是这需要一个前提，省略之后，读者要很清楚指的是什么。</p>
<h2 id="限定词的种类">限定词的种类</h2><p>限定词的分类，依其性质可以分成限制性（definite）限定词如the、those、John’s，以及非限制性（indefinite）限定词如a、any、many。依其限定范围可以分成部分性（partitive）限定词如some以及全称性（universal）限定词如all。与英文写作最密切的分类是以其在名词片语中出现的位置来分：可以分为前位限定词（predeterminers）、中位限定词（central determiners）以及后位限定词（postdeterminers）。</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">all</span> these many <span class="keyword">brave </span>soldiers</span><br><span class="line"><span class="label">half</span> your twenty expensive houses</span><br><span class="line"><span class="keyword">both </span>the first heroic explorers</span><br></pre></td></tr></table></figure>
<h3 id="前位限定词">前位限定词</h3><p>在限定词中排第一顺位的称为前位限定词，与中位限定词共同使用时，前位限定词一定要放在前面。包括all、both、half、one-third、one-fifth、double、twice、three times、such、what等待都属于前位限定词。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">all <span class="operator">the</span> girls</span><br><span class="line">both those cars</span><br><span class="line">half <span class="operator">an</span> hour</span><br><span class="line">double <span class="operator">the</span> <span class="built_in">sum</span></span><br><span class="line">twice my salary</span><br><span class="line"><span class="constant">one</span>-<span class="keyword">third</span> <span class="operator">the</span> <span class="built_in">time</span></span><br><span class="line">such <span class="operator">a</span> surprice</span><br><span class="line">what <span class="operator">a</span> day</span><br></pre></td></tr></table></figure>
<h3 id="后位限定词">后位限定词</h3><p>后位限定词在名词片语中要排在最后面。后位限定词包括所有的数目字（three、200）、序数（first、second、300th、last）以及many、much、little、few等等。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my <span class="constant">three</span> children</span><br><span class="line"><span class="operator">the</span> <span class="keyword">seventh</span> day</span><br><span class="line"><span class="operator">the</span> <span class="keyword">last</span> month</span><br><span class="line"><span class="operator">a</span> few people</span><br><span class="line"><span class="operator">the</span> many difficulties</span><br></pre></td></tr></table></figure>
<h3 id="中位限定词">中位限定词</h3><p>限定词当中出现频率最高的是中位限定词，包括冠词（a、an、the）、指示限定词（this、that、these、those）、不定限定词（some、any、either）、否定限定词（no、neither）、全称限定词（every、each）与所有格（my、your、John’s）等等都属于中位限定词。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">a</span> book, <span class="operator">an</span> egg, <span class="operator">the</span> money, this question, that man, thses kds, those places</span><br><span class="line">some <span class="built_in">time</span>, <span class="keyword">any</span> trouble, either bank, no problem, neither boy, every student</span><br><span class="line"><span class="keyword">each</span> worker, my home, your car, John<span class="string">'s daughter</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong>前位限定词、中位限定词和后位限定词可以共同出现在一个名词片语中，只要顺序别搞错，例如：all(前）my(中)many(后)friends。但是，如果同样属于中位限定词，那么彼此之间具有排他性，也就是只能采用一个，例如these some boys，any my car都是错的。</p>
</blockquote>
<h2 id="什么时候不需要限定词">什么时候不需要限定词</h2><p>不定冠词a(n)可以视为one的弱化（reduction）结果。也就是说，a(n)就代表one的意思，只是语气比较弱。a(n)和one同样是在限定它后面所接的名词范围是『一个』。如果后面的名词不适合以『一个』来表示，也就不适合加a(n)的话，就可以把限定词这个位置空下来。</p>
<h3 id="零冠词">零冠词</h3><p>为了便于诠释名词片语，同时也可以提醒使用者在写名词片语的时候不要忘了加限定词，创造出零冠词（the zero article）。</p>
<p>英文的冠词，只有定冠词（the）和不定冠词（a,an）两种。如果一个名词片语基于某种原因，前面无法加上不定冠词a或an，就可以选择把限定词位置空下来。这种情况下就是所谓的『零冠词』。比如new books这个名词片语，可以这样诠释：它前面还是有个限定词，叫做零冠词，因为限定词的位置放不进a或者an。</p>
<p>名词片语有三个位置：限定词 + 形容词 + 名词。当中形容词属于修饰语，可有可无。名词位置视情况可以省略，如the rich people可以省略为the rich，而those yellow flowers更可省略为those（这时候those升级为代名词）。只有限定词位置不可或缺。如果看到名词片语的限定词位置空下来了，就表示用上了零冠词。也就是说，这代表这个名词片语前面放不下a或an，限定词位置才可以缺省。</p>
<h4 id="零冠词的适用范围">零冠词的适用范围</h4><p>复数名词前面都可以采用零冠词。除了复数以外，抽象名词（如bravery，exhaustion）没有具体形状、不能以『一个』来表示（前面不能加a或an）。物质名词（如gold，air）虽然是具体的东西，可是形状不固定，仍然不能以『一个』来表示。这些不能以a或者an来限定的名词就可以把限定词位置空下来，也就是采用零冠词。例如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Honesty <span class="keyword">is</span> <span class="keyword">not</span> necessarily <span class="keyword">the</span> best policy. 诚实不一定是上策</span><br><span class="line">Fresh water <span class="keyword">is</span> a precious resource <span class="keyword">in</span> Saudi Arabia. 淡水在沙特阿拉伯是珍贵资源</span><br></pre></td></tr></table></figure>
<p>像honesty和water这些没有复数型态的词，都不适合加a或an。我们可以这么说：如果字尾加-s，表示该名词为复数，如果前面加a或an，表示『一个』，也就是单数。如果字尾不能加-s，通常表示这个词没办法数，自然也就不能说『一个』了。这时候我门就可以采用零冠词。</p>
<h3 id="专有名词">专有名词</h3><p>专有名词属于『特称』的概念，即天下只有一个的意思，讲到它，大家都知道是在讲什么，这时候就可以不需要『限定』。</p>
<p>要判断一个名词是否为专有名词，有时并不那么容易。比如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">There are <span class="constant">five</span> Sundays this month. 这个月有<span class="number">5</span>个星期天</span><br><span class="line">I have <span class="operator">an</span> appointment <span class="command"><span class="keyword">on</span> <span class="title">Sunday</span>. 我这星期天有约</span></span><br></pre></td></tr></table></figure>
<p>第一句的Sunday不算专有名词，可以加-s，而在一个星期中，星期天确实只有一天，所有是专有名词，前面不能加a，后面也不能加-s。</p>
<h4 id="普通名词专有化">普通名词专有化</h4><p>放在补语位置的普通名词，如果符合一些特定条件，可以视为专有名词看待。</p>
<p>以主词补语为例，因为补语和主词之间具有全等关系，如果主词是个专有名词，那么它的补语便可以视为专有名词看待，但是还要符合在补语位置的这个名词必须具有专有名词『只有一个』的特性这一条件。如：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bill Gates <span class="keyword">is</span> Chairman <span class="keyword">of</span> Microsoft. 比尔盖茨是微软董事长</span><br><span class="line">S V C</span><br><span class="line">Bill Gates <span class="keyword">is</span> also a trustee <span class="keyword">of</span> <span class="keyword">the</span> Bill&amp;Melinda Gates Foundation. 比尔盖茨也是比尔与梅琳达盖茨基金会的一名信托人。</span><br><span class="line">S V C</span><br></pre></td></tr></table></figure>
<p>Chairman是普通名词，是Bill Gates的补语，具有等价关系，而且，微软董事长只有一位，所以把Chairman当做专有名词。</p>
<p>trustee与Bill Gates也具有等价关系，但是比尔与梅琳达盖茨基金会有三名信托人，不具有唯一性，所以不能当做专有名词。</p>
<h4 id="同位格位置">同位格位置</h4><p>专有名词的同位格也有可能视为专有名词。</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ban Ki-moon, Secretary General <span class="keyword">of</span> the UN, <span class="keyword">is</span> a very powerful <span class="keyword">man</span>. 潘基文，联合国秘书长，是很有权势的人</span><br></pre></td></tr></table></figure>
<p>Secretary General of the UN一般称为同位格，其实就是who is Secretary General of the UN这个形容词子句的减化，其中who代表Ban Ki-moon,而Secretary General则是主语补语，和Ban Ki-moon是全等关系，而且符合专有名词『只有一个』的条件，所有可以视为专有名词。</p>
<h4 id="受词补语位置">受词补语位置</h4><p>写主词补语时，要注意该补语是否为专有名词，写受词补语时也是一样的。</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Queen Elizabeth made Charles Prince of Wales. 伊丽莎白女王封查尔斯为威尔士亲王</span><br><span class="line">S V <span class="keyword">O</span> <span class="keyword">C</span></span><br></pre></td></tr></table></figure>
<p>prince是普通名词，因为许多国家又prince，而在英国，威尔士亲王就是指定的王位继承人，同一时间只能有一个人。而且prince of Wales和Charles是等价关系，所以，它可以视为专有名词。</p>
<h4 id="普通名词抽象化">普通名词抽象化</h4><p>在一些特定的介系词片语中，可以看到单数的普通名词却没有加限定词。例如</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">You can contact him <span class="keyword">by</span> phone. 你可以打电话联系他</span><br><span class="line">Are you actually going <span class="keyword">around</span> <span class="keyword">the</span> lake <span class="function_start"><span class="keyword">on</span></span> foot. 你真的打算徒步环湖一周吗</span><br><span class="line">I always go <span class="keyword">to</span> church <span class="function_start"><span class="keyword">on</span></span> Sundays. 我礼拜天一定去教堂</span><br></pre></td></tr></table></figure>
<p>py phone中的phone是可数普通名词，而且是单数，但这里却没有加a。这是因为，用在by phone这个介系词片语中，phone已经从普通名词转为抽象名词使用了，它并不指一部或两部电话，而是指『打电话这一行为』。phone在这里已经由普通名词抽象化了。所有使用零冠词，其他句子也是一样的。</p>
<h3 id="定冠词the的用法">定冠词the的用法</h3><p>the可视为that或those的弱化形式，而that或those是指示限定词，有明确的指示功能。所以，the也又类似的功能。比如</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I need a book <span class="keyword">to</span> <span class="command">read</span> <span class="function_start"><span class="keyword">on</span></span> <span class="keyword">my</span> trip. 我在旅途中需要带本书读</span><br><span class="line">I have finished <span class="keyword">the</span> book you lent <span class="keyword">me</span>. 我已经把你借给我的书看完了</span><br></pre></td></tr></table></figure>
<p>第一句中，a book并没有指定哪一本书，而第二句，the book指定了『你借我的那本』。</p>
<p>如果上下文没有明确指出的，但有清楚暗示的，仍然要用定冠词the，例如：<br>先生对太太说<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I<span class="comment">'m going to the office now. 现在我要去办公室</span></span><br></pre></td></tr></table></figure></p>
<p>虽然没有明指，可是太太知道就是老公上班的办公室，这时要用the。</p>
<h4 id="定冠词和专有名词">定冠词和专有名词</h4><p>专有名词属于特称，只有一个对象存在，所有没必要用the来指定。所以专有名词和定冠词是相互冲突的，不能共存。</p>
<h2 id="代名词">代名词</h2><p>代名词是用来代替名词片语以避免重复的一种词类。</p>
<h3 id="代名词与先行词人称须一致">代名词与先行词人称须一致</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">People often think <span class="keyword">that</span> our difficulties are unique. 大家经常认为我们碰到的困难是独一无二的（不好）</span><br></pre></td></tr></table></figure>
<p>句中的代名词our，代表先行词people，但是people是第三人称，our却是第一人称，并不一致。可以改为下面的形式：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">People often think <span class="keyword">that</span> their difficulties are unique.</span><br><span class="line">We often think <span class="keyword">that</span> our difficulties are unique.</span><br></pre></td></tr></table></figure>
<h3 id="代名词与先行词单复数须一致">代名词与先行词单复数须一致</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If <span class="operator">the</span> campaign succeeds <span class="operator">in</span> raising huge sums, <span class="operator">the</span> sponsors will devote <span class="keyword">it</span> all <span class="built_in">to</span> disaster relief. 如果宣传运动成功募得巨款，主办单位将全数用于救灾</span><br></pre></td></tr></table></figure>
<p>代名词it是单数，它的先行词huge sums却是复数，不一致。可以改为下面的样子</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">If <span class="operator">the</span> campaign succeeds <span class="operator">in</span> raising huge sums, <span class="operator">the</span> sponsors will devote them all <span class="built_in">to</span> disaster relief.</span><br><span class="line">If <span class="operator">the</span> campaign succeeds <span class="operator">in</span> raising <span class="operator">a</span> huge <span class="built_in">sum</span>, <span class="operator">the</span> spnsors will devote <span class="keyword">it</span> all <span class="built_in">to</span> disaster relief.</span><br></pre></td></tr></table></figure>
<h3 id="代名词的性别考量">代名词的性别考量</h3><p>碰到人的代名词时，当不知道其性别时，可以使用he or she来代替he或者she，但这样很啰嗦，那可以直接用she。</p>
<h3 id="代名词必须有一个先行词">代名词必须有一个先行词</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Although <span class="operator">the</span> <span class="built_in">new</span> regulations allow them <span class="built_in">to</span> <span class="built_in">do</span> <span class="keyword">it</span>, high school graduates seldom go abroad <span class="keyword">for</span> higher education. 虽然新规定允许这样做，但高中毕业生很少出国深造</span><br></pre></td></tr></table></figure>
<p>代名词it必须有一个先行词，而且这个先行词应该是名词片语。这句话中却找不到先行词。可以该为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Although the <span class="keyword">new</span> regulations allow them <span class="keyword">to</span> <span class="keyword">do</span> <span class="keyword">so</span>, high school graduates seldom <span class="keyword">go</span> abroad <span class="keyword">for</span> higher education.</span><br></pre></td></tr></table></figure>
<p>改为do so，没有了代名词，变成了助动词do加副词so，『这样做』，代表后面的go abroad for higher education。</p>
<h3 id="代名词只能有一个先行词">代名词只能有一个先行词</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">When tourists <span class="keyword">first</span> arrived <span class="operator">in</span> this <span class="built_in">new</span> resort, <span class="operator">the</span> locals thought they were very lucky people. 观光客初抵这个新度假区时，当地人认为他们是非常幸运的人</span><br></pre></td></tr></table></figure>
<p>这个句子不好，因为没有把话说清楚，they可以指tourists和the locals。可以改为</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">When tourists <span class="keyword">first</span> arrived <span class="operator">in</span> this <span class="built_in">new</span> resort, <span class="operator">the</span> locals thought these outsiders were very lucky people.</span><br><span class="line">When tourists <span class="keyword">first</span> arrived <span class="operator">in</span> this <span class="built_in">new</span> resort, <span class="operator">the</span> locals considered themselves very lucky people.</span><br></pre></td></tr></table></figure>
<h2 id="总结">总结</h2><p>关于名词片语与代名词，重要观念有：</p>
<ol>
<li>名词片语包括限定词、形容词、名词三个位置，任何一个位置都可能省略</li>
<li>如果名词片语没有限定词，是因为该名词不适合加a或an</li>
<li>a或an是one的弱化结果，而the是that或those的弱化结果</li>
<li>代名词必须有一个，也只能有一个先行词，这个先行词应该是名词片语</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<p>《文法俱乐部》读书笔记.</p>]]>
    
    </summary>
    
      <category term="English" scheme="http://ztmark.github.io/tags/English/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Java的反射]]></title>
    <link href="http://ztmark.github.io/2015/12/11/Java%E7%9A%84%E5%8F%8D%E5%B0%84/"/>
    <id>http://ztmark.github.io/2015/12/11/Java的反射/</id>
    <published>2015-12-10T16:00:00.000Z</published>
    <updated>2015-12-11T08:56:22.000Z</updated>
    <content type="html"><![CDATA[<p>Java反射相关内容。</p>
<a id="more"></a>
<h2 id="Class对象">Class对象</h2><p>Java中的反射最关键的一个类就是Class类，首先你要先得到这个类的对象，一般有两种方式，如果在编译时你知道那个类名，你可以直接<code>Class cls = MyObject.class;</code>来得到Class对象。如果编译时不知道类名，那需要使用<code>Class = Class.forname(&quot;com.mark.MyObject&quot;);</code>来得到Class对象，这里需要类的全限定名。</p>
<p>当得到Class对象后，那基本就能通过Class对象得到关于这个类的一切数据：字段、方法、构造函数等等信息都可以通过这个Class对象的相对应方法来获取到。</p>
<h3 id="内部类">内部类</h3><p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mark.reflection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericClass</span> </span>&#123;</span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"InnerClass method"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们知道内部类的类名是外部类+$+内部类名，所以，我门可以这样加载内部类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class cls = Class.forName(<span class="string">"com.mark.reflection.GenericClass$InnerClass"</span>);</span><br></pre></td></tr></table></figure>
<p>这样我们得到了内部类的Class对象，但是如果想试用Class对象来创建内部类实例，则会遇到问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GenericClass.InnerClass ic = (GenericClass.InnerClass) cls.getConstructor().newInstance(gc);</span><br></pre></td></tr></table></figure>
<p>上面的代码运行将会报<code>NoSuchMethodException</code>的错误，也就是说没有找到无参构造函数。因为这个内部类并不是静态的，它需要一个外部类的实例引用。通过断点，可以发现在Class的<code>getConstructor</code>方法调用了<code>getConstructor0()）</code>方法，在<code>getConstructor0()）</code>方法中通过得到类的所有构造函数，然后比较参数来得到指定的构造函数，而通过debug发现，这个类只有一个带有GenericClass参数的构造函数。</p>
<p>所以可以使用下面的方式来实例化一个内部类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class outerCls = cls.getEnclosingClass();</span><br><span class="line">GenericClass&lt;String&gt; gc = (GenericClass&lt;String&gt;) outerCls.&lt;String&gt;newInstance();</span><br><span class="line">GenericClass.InnerClass ic = (GenericClass.InnerClass) cls.getConstructor(GenericClass.class).newInstance(gc);</span><br></pre></td></tr></table></figure>
<p><code>getEnclosingClass</code>方法可以获得外部类的Class对象。</p>
<p>上面的方式实例化内部类略显麻烦，我们可以直接加载外部类的Class，然后实例化外部类对象再实例化内部类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class cls = Class.forName(<span class="string">"com.mark.reflection.GenericClass"</span>);</span><br><span class="line">GenericClass&lt;String&gt; gc = (GenericClass&lt;String&gt;) cls.&lt;String&gt;newInstance();</span><br><span class="line">GenericClass.InnerClass ic = gcs.new InnerClass();</span><br></pre></td></tr></table></figure>
<h3 id="数组类型">数组类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Class cls = <span class="keyword">int</span>[].class;</span><br><span class="line">Class cls = Class.forName(<span class="string">"[I"</span>);</span><br><span class="line">System.out.println(cls.getComponentType());</span><br></pre></td></tr></table></figure>
<p>可以通过上面两种方式来得到int数组的Class对象，其他的基本类型数组也是类似的。如果不知道forName的参数是什么，可以<code>System.out.println(boolean[].class);</code>看看就知道了。通过<code>cls.getComponentType()</code>可以得到数组元素的类型。</p>
<p>数组实例无法直接<code>cls.newInstance()</code>得到，需要借助<code>java.lang.reflect.Array</code>类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] ints = (<span class="keyword">int</span>[]) Array.newInstance(<span class="keyword">int</span>.class, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>创建一个长度为2的int数组。这也适用其他类型数组。</p>
<h2 id="泛型信息">泛型信息</h2><p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mark.reflection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericClass</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> T val;</span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; list;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">method2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于泛型类，可以通过Class对象得到泛型相关的信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Class cls = Class.forName(<span class="string">"com.mark.reflection.GenericClass"</span>);</span><br><span class="line">Method method = cls.getMethod(<span class="string">"method1"</span>, <span class="keyword">null</span>);</span><br><span class="line">System.out.println(method.getGenericReturnType()); <span class="comment">// T</span></span><br><span class="line">System.out.println(method.getReturnType()); <span class="comment">// class java.lang.Object</span></span><br><span class="line">method = cls.getMethod(<span class="string">"method2"</span>, <span class="keyword">null</span>);</span><br><span class="line">System.out.println(method.getGenericReturnType()); <span class="comment">// java.util.List&lt;T&gt;</span></span><br><span class="line">System.out.println(method.getReturnType()); <span class="comment">// interface java.util.List</span></span><br><span class="line">Field field = cls.getField(<span class="string">"val"</span>);</span><br><span class="line">System.out.println(field.getGenericType()); <span class="comment">// T</span></span><br><span class="line">System.out.println(field.getType()); <span class="comment">// class java.lang.Object</span></span><br><span class="line"></span><br><span class="line">method = cls.getMethod(<span class="string">"method4"</span>, List.class);</span><br><span class="line">Parameter parameter = method.getParameters()[<span class="number">0</span>];</span><br><span class="line">Type type = parameter.getType();</span><br><span class="line">System.out.println(type); <span class="comment">// interface java.util.List</span></span><br><span class="line">type = parameter.getParameterizedType();</span><br><span class="line"><span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">  ParameterizedType pt = (ParameterizedType) type;</span><br><span class="line">  System.out.println(pt); <span class="comment">// java.util.List&lt;java.lang.String&gt;</span></span><br><span class="line">  System.out.println(Arrays.toString(pt.getActualTypeArguments())); <span class="comment">//[class java.lang.String]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Java反射相关内容。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《文法俱乐部》读书笔记之第一章基本句型]]></title>
    <link href="http://ztmark.github.io/2015/12/09/%E3%80%8A%E6%96%87%E6%B3%95%E4%BF%B1%E4%B9%90%E9%83%A8%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%AC%AC%E4%B8%80%E7%AB%A0%E5%9F%BA%E6%9C%AC%E5%8F%A5%E5%9E%8B/"/>
    <id>http://ztmark.github.io/2015/12/09/《文法俱乐部》读书笔记之第一章基本句型/</id>
    <published>2015-12-08T16:00:00.000Z</published>
    <updated>2015-12-09T06:04:36.000Z</updated>
    <content type="html"><![CDATA[<p>《文法俱乐部》读书笔记.</p>
<a id="more"></a>
<h2 id="五种基本句型">五种基本句型</h2><ol>
<li>S+V</li>
<li>S+V+O</li>
<li>S+V+C</li>
<li>S+V+O+O</li>
<li>S+V+O+C</li>
</ol>
<p>S：主词 V：动词 O：受词 C：补语</p>
<p><strong>动词特性</strong>主要看这个动词是<strong>及物(transitive)</strong>还是<strong>不及物(intransitive)</strong>，另一个角度是看它<strong>完全(complete)</strong>还是<strong>不完全(incomplete)</strong>。</p>
<p>如果它是及物动词，那么它后面必须有一个受词(Object)，因此，它只能用在上述的2,4和5句型中，如果它是个不及物动词，就只能用在上述的3和4这种不带受词的句型中。有些词即可以是及物动词也可以是不及物动词。</p>
<p>如果这个动词是个不完全动词，那么后面需要有个补语(complement)来补充它，产生完整的句意，那么只有上述的3和5句型可选。反之，如果是完全动词，那么后面不需要补语，就可以使用上述的1，2和4句型。</p>
<p>一个完整的句子，必须能够表达完整的意思，这需要两个部分：主部(subject)和述部(predicate)。主部是表示这个句子讲的是『什么人或什么东西』。述部告诉我们这个人或东西『怎么样』。</p>
<pre><code>The dog barked <span class="keyword">at</span> <span class="operator">the</span> mailman. 狗冲着邮差叫。
S V
The dog bit <span class="operator">the</span> mailman. 狗咬邮差。
S V O
</code></pre><p>在第一个句子的主部就是the dog，它就是这个句子叙述的对象，这个句子告诉读者讲的有关the dog的事，什么事呢，主要是『叫(barked)』。述部的动词barked构成这个句子最主要的叙述内容。对谁叫是可有可无的细节，at the mailman是用来修饰动词的。只说The dog barked仍可以构成一个完整的句子。</p>
<pre><code>Don<span class="attribute">'t</span> worry. It doesn<span class="attribute">'t</span> <span class="typename">bit</span>. 别担心，它不咬人。
S V
</code></pre><p>这里的bit后面没有带受词，主词仍然是It狗，这时，bit就成了不及物动词。    </p>
<p><strong>补语</strong>是用来对欠缺叙述能力的动词的补充。在所有的英文动词中，只有解释为『是』的这种动词是空的、没有意义的，这种动词需要补语来补充句子的意思。比如：</p>
<pre><code>The dog was a bulldog. 那是只斗牛犬
S V <span class="keyword">C</span>

The dog was mean. 那只狗很凶恶
S V <span class="keyword">C</span>
</code></pre><p>was这个动词可以解释为『是』，它并没有告诉我们有关the dog的任何事。</p>
<p>这种没有叙述能力，只是将主词和后面做叙述的部分连起来的词又叫『连缀动词(linking verb)』。Be动词翻译为『是』是最具有代表性的『连缀动词』。在所有的英文动词中，凡是后面必须接补语的动词都可以解释为各种各样的『是』。比如：</p>
<pre><code>look 看起来是
seem 似乎是
appear 显然是
<span class="keyword">sound</span> 听起来是
feel 摸起来是
taste 尝起来是
stay 仍然是
</code></pre><p>例句：</p>
<pre><code>That purse looks pretty. 那个包包很好看
The question seems easy. 这个问题好像很容易
He appears quite <span class="tag">a</span> gentleman. 他似乎是个十足的绅士
Your suggestion sounds exciting. 你的提议听起来很刺激
</code></pre><p>这种在动词后面的那个部分，是在对主词进行实质的叙述、补充句意的完整，叫做主词补语，凡是动词解释为各种各样的『是』的句子都属于这种句型及S+V+C。</p>
<p>S+V+O+C句型是用补语来告诉读者受词是什么。比如</p>
<pre><code>I found <span class="operator">the</span> purse pretty. 我觉得这个包包很漂亮
The tip made <span class="operator">the</span> question easy. 因为又提示，所有问题变得很容易
I consider him quite <span class="operator">a</span> gentleman. 我任务他是个十足的绅士
</code></pre><p>第一个例句受词the purse和受词补语pretty之间虽然没有『是』字，但是暗示存在『我觉的这个包包<strong>是</strong>很漂亮的』，在受词和受词补语之间加个be动词进去，就变成了The purse is pretty，就是S+V+C的句型了。</p>
<p>补语的类型一般是名词或者形容词，还有就是地方副词，用来修饰名词『在什么地方』。比如</p>
<pre><code>The key is there. 钥匙在哪里
S V <span class="keyword">C</span>
He left the key there. 他把钥匙留在那里。
S V <span class="keyword">O</span> <span class="keyword">C</span>
</code></pre><p>没有补语的be动词并不解释为『是』，而要解释为『存在』。比如</p>
<pre><code>I think<span class="comment">; therefore I am. am 翻译为存在</span>
</code></pre><p>有一种动词可以接受两个受词。比如</p>
<pre><code>His wife gave him <span class="operator">a</span> jar <span class="operator">of</span> honey. 他老婆给他一瓶蜂蜜
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[<p>《文法俱乐部》读书笔记.</p>]]>
    
    </summary>
    
      <category term="English" scheme="http://ztmark.github.io/tags/English/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Singleton Pattern]]></title>
    <link href="http://ztmark.github.io/2015/12/08/Singleton/"/>
    <id>http://ztmark.github.io/2015/12/08/Singleton/</id>
    <published>2015-12-07T16:00:00.000Z</published>
    <updated>2015-12-08T10:22:44.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://zh.wikipedia.org/zh/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F" target="_blank" rel="external">单例模式</a>能够保证类只有一个实例对象。在<code>Java</code>中可以使用多种方式来实现单例模式。</p>
<a id="more"></a>
<h2 id="Eager_initialization">Eager initialization</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonEagerInit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SingletonEagerInit instance = <span class="keyword">new</span> SingletonEagerInit();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonEagerInit</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonEagerInit <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方式在类加载的时候就对实例进行初始化。然后每次调用<code>getInstance</code>都会返回这个实例对象。</p>
<p>该方式是有缺点，如果这个类的对象非常大，在加载该类后却没有调用<code>getInstance</code>方法，即加载了类，但没有使用该类的对象。但是这个对象已经被实例化，会占用一部分内存，如果我们用不着这个对象，这些内存就浪费了。</p>
<h2 id="Lazy_initialization">Lazy initialization</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonLazyInit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonLazyInit instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonLazyInit</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingletonLazyInit <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingletonLazyInit();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>延迟初始化的方式能够在真正用到实例对象的时候才对其进行初始化。</p>
<p>对整个方法进行<code>synchronized</code>，避免了多线程下的同步问题，但是对整个方法进行<code>synchronized</code>效率会下降。</p>
<h2 id="double_checked_locking">double checked locking</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDoubleChecked</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingletonDoubleChecked instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDoubleChecked</span> <span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// effective java : 第71条</span></span><br><span class="line">    <span class="comment">// 使用局部变量可以提供性能</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDoubleChecked <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SingletonDoubleChecked result = instance;</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(SingletonDoubleChecked.class) &#123;</span><br><span class="line">                result = instance;</span><br><span class="line">                <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = result = <span class="keyword">new</span> SingletonDoubleChecked();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该方法并为整个方法进行<code>synchronized</code>,尽可能的缩小了同步块的范围。</p>
<p>字段<code>instance</code>用<code>volatile</code>修饰是为了可见性，一致性，顺序性，可见性就是指当对一个临界资源进行修改后，其他线程就能马上觉察到该修改，所有线程看到这个变量的值是一致的,而且编译器也不会对其进行指令重排。</p>
<p><code>getInstance</code>方法中使用局部变量<code>result</code>的原因可以见<code>Effective Java</code>第二版的第71条。</p>
<blockquote>
<p>这个变量的作用是确保实例变量只在已经被初始化的情况下读取一次。虽然这不是严格要求，但是可以提升性能。</p>
</blockquote>
<p>我的理解是<code>instance</code>这个实例变量是在堆内存中分配的，而局部变量<code>result</code>是在栈中分配的，栈的读取速度要快于堆的读取速度。</p>
<p>如果该单例的类需要实现序列化，那么在加上<code>implements Serializable</code>后，还需要添加<code>readResolve</code>方法。该类的实例域都要声明为<code>transient</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对与<code>clone</code>方法，可以直接抛出异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CloneNotSupportedException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Initialization-on-demand_holder_idiom">Initialization-on-demand holder idiom</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonByHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonByHolder <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonByHolder</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> SingletonByHolder instance = <span class="keyword">new</span> SingletonByHolder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式也是只有在第一次调用<code>getInstance</code>方法时才进行初始化。在加载<code>SingletonByHolder</code>类时并不会加载<code>SingletonHolder</code>类，所以就不会对<code>instance</code>进行初始化，只有在<code>getInstance</code>方法中调用<code>SingletonHolder.instance</code>才会加载<code>SingletonHolder</code>类，然后进行初始化。</p>
<h2 id="The_enum_way">The enum way</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton &#123;</span><br><span class="line"></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用枚举来实现单例模式是被推荐的。</p>
<blockquote>
<p>这种方法在功能上与公有域方法相近，但是它更加简洁，无偿地提供了序列化机制，绝对防止多次实例化，即使是在面对复杂的序列化或者反射攻击的时候。虽然这种方法还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="http://zh.wikipedia.org/zh/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">单例模式</a>能够保证类只有一个实例对象。在<code>Java</code>中可以使用多种方式来实现单例模式。</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[一道有趣的题]]></title>
    <link href="http://ztmark.github.io/2015/12/04/%E4%B8%80%E9%81%93%E6%9C%89%E8%B6%A3%E7%9A%84%E9%A2%98/"/>
    <id>http://ztmark.github.io/2015/12/04/一道有趣的题/</id>
    <published>2015-12-03T16:00:00.000Z</published>
    <updated>2015-12-04T04:38:57.000Z</updated>
    <content type="html"><![CDATA[<p>一道有趣的算法题。</p>
<a id="more"></a>
<p>看《算法设计与分析基础》第三版的时候，1.1节习题中又这么一道题：</p>
<blockquote>
<p><strong>带锁的门</strong>：在走廊上有n个带锁的门，从1到n一次编号。最初所有的门都是关着的。我们从门前经过n次，每次都从1号门开始。在第i次经过时(i=1，2，3，…，n)我们改变i的整数倍号锁的状态：如果门是关着的，就打开它；如果门是打开的，就关上它。在最后一次经过，哪些门是打开的，哪些门是关上的？有多少打开的门？</p>
</blockquote>
<p>一开始没什么头绪，不过我们可以写个例子看看，比如取n等于10。</p>
<table>
<thead>
<tr>
<th>n/门号</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>0</strong></td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><strong>1</strong></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td><strong>2</strong></td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td><strong>3</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><strong>4</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><strong>5</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td><strong>6</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td><strong>7</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td><strong>8</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td><strong>9</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td><strong>10</strong></td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>n为0表示初始状态，0表示关闭，1表示打开。</p>
<p>在写这个例子的时候，我们会发现门号如果能被k(第k次经过)整除，该门的状态就会发生变化，当k&gt;$\sqrt{k}$时，只会改变第k个门的状态。</p>
<p>我接着就能发现状态改变偶数次后，状态不变，也就是说，对于第k个门，如果k有偶数个约数，那么这扇门的状态最后还是和初始状态一样，这样我们的问题就是找出哪些数有偶数个约数。</p>
<p>我们观察上面的例子，发现1,4和9的最后状态是与初始状态不一样外，其他门的状态都一样。到这里，我们可能很容易就猜想到1，4，9等这些是某个数的平方的数有奇数个约数，当然，我们可以取n的值16，25再看看。能想到这里，其实为什么这些数有奇数个约数也很容易想到。</p>
<p>如果k是n的一个约数，那么n除以k等于$\frac nk$余0，那么$\frac nk$也是n的一个约数，这样，n的约数一般都是成对出现，只有一种情况就是k等于$\frac nk$的时候，即这两个约数相等，那么这时只算一个约数。而只有像1，4，9这些数会出现这种情况，1比较特别。</p>
<p>这样也就回答了上面的那个问题。</p>
<p>下面是代码演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	printState(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printState</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=n; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (isSquared(i)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"Door "</span> + i  + <span class="string">" is opened"</span>);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">"Door "</span> + i  + <span class="string">" is closed"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSquared</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (i * i &lt; n) i++;</span><br><span class="line">	<span class="keyword">return</span> i * i == n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>一道有趣的算法题。</p>]]>
    
    </summary>
    
      <category term="Algorithm" scheme="http://ztmark.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《Java并发编程的艺术》读书笔记五]]></title>
    <link href="http://ztmark.github.io/2015/12/02/%E3%80%8AJava%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%BA%94/"/>
    <id>http://ztmark.github.io/2015/12/02/《Java并发编程的艺术》读书笔记五/</id>
    <published>2015-12-01T16:00:00.000Z</published>
    <updated>2015-12-02T07:12:20.000Z</updated>
    <content type="html"><![CDATA[<p>《Java并发编程的艺术》读书笔记</p>
<a id="more"></a>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=18127334&auto=0&height=66"></iframe>

<h2 id="并发工具类">并发工具类</h2><h3 id="CountDownLatch">CountDownLatch</h3><p>CountDownLatch允许一个或多个线程等待其他线程完成操作。</p>
<p>CountDownLatch的构造函数接受一个int类型的参数作为计数器，在调用countDown方法后，计数器会减1，在计数器减为0时，在CountDownLatch上因为调用await方法而阻塞的线程会被唤醒继续执行。</p>
<p>CountDownLatch只能使用一次，无法重新初始化或修改计数器的值。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        CountDownLatch latch = <span class="keyword">new</span> CountDownLatch(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread());</span><br><span class="line">            latch.countDown();</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread());</span><br><span class="line">            latch.countDown();</span><br><span class="line">        &#125;).start();</span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(Thread.currentThread());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main线程会在<code>latch.await()</code>阻塞，等待latch的计数器减为0后继续往下执行，上面两个线程在打印出线程信息后会将计数器减1，在上面两个线程执行完毕后，计数器减为0，main线程才能继续往下执行。</p>
<h3 id="CyclicBarrier">CyclicBarrier</h3><p>CyclicBarrier让一组线程到达一个屏障时被阻塞，直到所有的线程都到达屏障时，屏障才回放行所有线程，被拦截的线程才能继续往下执行。</p>
<p>CyclicBarrier的构造函数带又一个int的参数，表示需要拦截多少线程，每个线程调用await方法告诉CyclicBarrier它到达屏障了，然后阻塞。CyclicBarrier还有一个带Runnable参数的构造函数，在所有线程都到达了屏障，会先执行这个Runnable。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CyclicBarrier barrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">3</span>, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> ConcurrentHashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWork</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                map.put(Thread.currentThread().getName(), ThreadLocalRandom.current().nextInt(<span class="number">100</span>));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    barrier.await();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Integer i : map.values()) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CyclicBarrierTest cyclicBarrierTest = <span class="keyword">new</span> CyclicBarrierTest();</span><br><span class="line">        cyclicBarrierTest.doWork();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Semaphore">Semaphore</h3><p>Semaphore用来控制同时访问特定资源的线程数量，通过协调各个线程，以保证合理的使用公共资源。</p>
<p>Semaphore的构造函数带有一个int的参数，表示同时允许多少线程访问资源，线程在访问资源之前需要获取Semaphore许可，获得了许可的线程才能访问资源，未获得许可的线程将被阻塞。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main线程在获取许可的时候将会阻塞，因为之前两个线程已经获取了许可在执行操作并没有多余的许可了。</p>
<h3 id="Exchanger">Exchanger</h3><p>Exchanger是一个用于线程间协作的工具类，用于进行线程间的数据交换。Exchanger只提供了两个exchange方法，包括一个支持超时的exchange方法。两个线程通过exchange方法交换数据，如果第一个线程先执行exchange方法，它会一直等待第二个线程执行exchange方法。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExchangerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Exchanger&lt;String&gt; exchanger = <span class="keyword">new</span> Exchanger&lt;&gt;();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(exchanger.exchange(<span class="string">"bbbbb"</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        String v1 = exchanger.exchange(<span class="string">"aaa"</span>);</span><br><span class="line">        System.out.println(v1);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(exchanger.exchange(<span class="string">"ccccc"</span>));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        String v2 = exchanger.exchange(<span class="string">"bbb"</span>);</span><br><span class="line">        System.out.println(v2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="线程池">线程池</h2><p>使用线程池的好处：降低资源消耗、提高响应速度和提高线程的可管理性。</p>
<p>ThreadPoolExecutor的execute方法的执行过程：</p>
<ol>
<li>如果当前运行的线程少于corePoolSize，则创建新线程来执行任务（需要获取全局锁）</li>
<li>如果运行的线程等于或多于corePoolSize，则将任务加入BlockingQueue。</li>
<li>如果无法将任务加入BlockingQueue（队列已满），则创建新的线程来处理任务（需要获取全局锁）</li>
<li>如果创建新线程将使当前运行的线程超出maximumPoolSize，任务将被拒绝，并调用RejectedExecutionHandler.rejectedExecution方法。</li>
</ol>
<p>线程池的创建可以指定这么几个参数：</p>
<ul>
<li>corePoolSize: 线程池的基本大小，当提交一个任务到线程池，如果线程池线程数量没有达到corePoolSize，即使又空闲线程，线程池也会创建新的线程来执行该任务</li>
<li>runnableTaskQueue: 任务队列，用于保存等待执行的任务的阻塞队列。可以有如下几个队列可选：<ul>
<li>ArrayBlockingQueue</li>
<li>LinkedBlockingQueue</li>
<li>SynchronousQueue</li>
<li>PriorityBlockingQueue</li>
</ul>
</li>
<li>ThreadFactory:用于创建线程的工程</li>
<li>RejectedExecutionHandler: 饱和策略，当队列和线程池满了，使用该策略来处理新任务，JDK1.5又如下的策略：<ul>
<li>AbortPolicy:直接抛出异常</li>
<li>CallerRunsPolicy: 只用调用者所在线程来执行任务</li>
<li>DiscardOldestPolicy: 丢弃队头的任务，并执行当前任务</li>
<li>DiscardPolicy: 不处理，丢弃。</li>
</ul>
</li>
<li>keepAliveTime:线程活动保持时间，超出线程池corePoolSize的工作线程空闲后，保持存活的时间。</li>
<li>TimeUnit:keepAliveTime的单位</li>
</ul>
<p>线程池通过execute方法提交一个无返回值的任务，使用submit提交一个有返回值的任务，该方法返回一个Future。</p>
<p>线程池通过shutdown和shutdownNow方法来关闭线程池，它们通过遍历线程池中的线程，调用线程的interrupt方法来中断线程，所以无法响应中断的任务无法终止。shutdownNow会中断正在执行或暂停的任务，而shutdown只中断没有执行的任务。</p>
<p>线程池的配置需要根据任务的特点和系统的配置来进行。CPU密集型的任务可以将线程池中的线程数量配置得和CPU数量的大小，IO密集型的任务则可以配置更多的线程，混合型的可以将任务分成CPU密集和IO秘籍两类来进行。阻塞队列推荐使用有界队列。</p>
<h2 id="Executor框架">Executor框架</h2><p>Executor框架包括3大部分：</p>
<ul>
<li>任务：包括执行任务需要实现的接口 Runnable接口和Callable接口</li>
<li>任务的执行：包括任务执行机制的核心接口Executor，以及继承Executor的ExecutorService接口，其实现类有ThreadPoolExecutor和ScheduledThreadPoolExecutor。</li>
<li>异步计算的结果：包括Future接口和FutureTask实现类</li>
</ul>
<p>Executors工具类可以用来创建ThreadPoolExecutor和ScheduledThreadPoolExecutor实例。</p>
<p>ThreadPoolExecutor有3种类型</p>
<ul>
<li>FixedThreadPool</li>
<li>SingleThreadExecutor</li>
<li>CachedThreadPool</li>
</ul>
<p>ScheduledThreadPoolExecutor有2种类型</p>
<ul>
<li>ScheduledThreadPoolExecutor</li>
<li>SingleThreadScheduledExecturor</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>《Java并发编程的艺术》读书笔记</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[《Java并发编程的艺术》读书笔记四]]></title>
    <link href="http://ztmark.github.io/2015/12/01/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E8%89%BA%E6%9C%AF%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E5%9B%9B/"/>
    <id>http://ztmark.github.io/2015/12/01/Java并发编程的艺术》读书笔记四/</id>
    <published>2015-11-30T16:00:00.000Z</published>
    <updated>2015-12-01T13:40:54.000Z</updated>
    <content type="html"><![CDATA[<p>《Java并发编程的艺术》读书笔记</p>
<a id="more"></a>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=21373645&auto=0&height=66"></iframe>

<h2 id="并发容器">并发容器</h2><h3 id="ConcurrentHashMap">ConcurrentHashMap</h3><p>ConcurrentHashMap是线程安全的HashMap。HashMap在多线程下会导致死循环，而线程安全的HashTable则由于每个方法都使用了synchronized而导致效率底下。ConcurrentHashMap通过将数据分成一段一段地存储，然后给每段数据都配一把锁，当一个线程占用锁访问其中一个数据段的时候，其他线程也能同时访问其他数据段的数据，从而大大地提高了效率。</p>
<p>ConcurrentHashMap由Segment数组结构和HashEntry数据结构组成，Segment是一种可重入锁，HashEntry存储键值对数据。每个Segment守护着一个HashEntry数组中的元素，要对HashEntry进行修改，需要获取对应的Segment锁。</p>
<p>ConcurrentHashMap的get方法不需要加锁就可以获取，put方法先定位Segment，获取到Segment锁后，先判断是否要扩容HashEntry数组，然后添加，size方法要统计所有的Segment下的HashEntry的大小才能获得总的大小，ConcurrentHashMap先尝试2次不锁住所有的Segment的方式来统计，如果统计过程中容器的大小发生变化（通过modCount检测）则再使用锁住Segment的方式来统计。</p>
<h3 id="ConcurrentLinkedQueue">ConcurrentLinkedQueue</h3><p>ConcurrentLinkedQueue是使用非阻塞的方式来实现的线程安全队列。</p>
<p>ConcurrentLinkedQueue的入队操作分两步，先定位尾节点，然后将入队节点设为尾节点。出队通过获取头结点并通过CAS设置头结点为null来实现。</p>
<h3 id="阻塞队列">阻塞队列</h3><p>阻塞队列是支持阻塞入队和阻塞出队的队列。</p>
<p>插入和移除的4种处理方式</p>
<table>
<thead>
<tr>
<th>方法/处理方式</th>
<th>抛出异常</th>
<th>返回特殊值</th>
<th>一直阻塞</th>
<th>超时退出</th>
</tr>
</thead>
<tbody>
<tr>
<td>插入方法</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td>移除方法</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td>检查方法</td>
<td>element()</td>
<td>peek()</td>
<td>不可用</td>
<td>不可用</td>
</tr>
</tbody>
</table>
<p>JDK7中又7种阻塞队列：</p>
<ul>
<li>ArrayBlockingQueue : 一个数组结构组成的有界阻塞队列</li>
<li>LinkedBlockingQueue : 一个由链表结构组成的有界阻塞队列</li>
<li>PriorityBlockingQueue : 一个支持优先级排序的无界阻塞队列</li>
<li>DelayQueue : 一个使用优先级队列实现的无界阻塞队列</li>
<li>SynchronousQueue : 一个不存储元素的阻塞队列</li>
<li>LinkedTransferQueue : 一个由链表结构组成的无界阻塞队列</li>
<li>LinkedBlockingDeque : 一个由链表结构组成的双向阻塞队列</li>
</ul>
<p>DelayQueue是支持延时获取元素的无界阻塞队列，其中的元素必须实现Delay接口，实现方式可以参考ScheduledThreadPoolExecutor里ScheduledFutureTask类的实现。</p>
<p>SynchronousQueue是一个不存储元素的阻塞队列，每个put操作必须等待一个take操作，否则不能继续添加元素。</p>
<h2 id="Fork/Join框架">Fork/Join框架</h2><p>Fork/Join框架是Java7提供的一个用于并行执行任务的框架，是一个把大任务分割成若干个小任务，最终汇总每个小任务结果后得到大任务结果的框架。</p>
<p>使用Fork/Join框架时需要清楚如何分割任务，在什么时候停止分割，如何汇总结果，有结果的任务需要继承RecursiveTask类。</p>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THRESHOLD = <span class="number">2</span>; <span class="comment">// 阀值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CountTask</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//如果任务足够小就计算任务</span></span><br><span class="line">        <span class="keyword">boolean</span> canCompute = (end - start) &lt;= THRESHOLD;</span><br><span class="line">        <span class="keyword">if</span> (canCompute) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt;= end; i++) &#123;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//如果任务大于阀值，就分割成两个子任务来计算</span></span><br><span class="line">            <span class="keyword">int</span> middle = (start + end) / <span class="number">2</span>;</span><br><span class="line">            CountTask leftTask = <span class="keyword">new</span> CountTask(start, middle);</span><br><span class="line">            CountTask rightTask = <span class="keyword">new</span> CountTask(middle + <span class="number">1</span>, end);</span><br><span class="line">            <span class="comment">//执行子任务</span></span><br><span class="line">            leftTask.fork();</span><br><span class="line">            rightTask.fork();</span><br><span class="line">            <span class="comment">//等待子任务执行完成,并得到其结果</span></span><br><span class="line">            <span class="keyword">int</span> leftResult = leftTask.join();</span><br><span class="line">            <span class="keyword">int</span> rightResult = rightTask.join();</span><br><span class="line">            <span class="comment">//合并子任务的结果</span></span><br><span class="line">            sum = leftResult + rightResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        <span class="comment">// 生成一个计算任务， 负责计算 1 + 2 + 3 + 4</span></span><br><span class="line">        CountTask task = <span class="keyword">new</span> CountTask(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 执行一个任务</span></span><br><span class="line">        Future&lt;Integer&gt; result = forkJoinPool.submit(task);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(result.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException ignore) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Fork/Join框架提供了isCompletedAbnormally()方法来检查任务是否已经抛出异常或已经被取消了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (task.isCompletedAbnormally()) &#123;</span><br><span class="line">	System.out.println(task.getException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getException方法在任务被取消了返回CancellationException，抛出异常则返回Throwable对象，任务没有完成或者没有抛出异常则返回null。</p>
<p>ForkJoinPool由ForkJoinTask数组和ForkJoinWorkerThread数组组成，ForkJoinTask数组存放提交给ForkJoinPool的任务，ForkJoinWorkerThread数组负责执行这些任务。</p>
<h2 id="原子操作类">原子操作类</h2><p>在java.util.concurrent.atomic包中提供了13类，用来提供原子操作。</p>
<h3 id="操作基本类型">操作基本类型</h3><ul>
<li>AtomicBoolean</li>
<li>AtomicInteger</li>
<li>AtomicLong</li>
</ul>
<p>三个类提供的方法类似，有addAndGet、compareAndSet、getAndIncrement、lazySet和getAndSet等。</p>
<h3 id="操作数组">操作数组</h3><ul>
<li>AtomicIntegerArray</li>
<li>AtomicLongArray</li>
<li>AtomicReferenceArray</li>
</ul>
<h3 id="操作引用类型">操作引用类型</h3><ul>
<li>AtomicReference</li>
<li>AtomicReferenceFieldUpdater</li>
<li>AtomicMarkableReference</li>
</ul>
<h3 id="操作字段">操作字段</h3><ul>
<li>AtomicIntegerFieldUpdater</li>
<li>AtomicLongFieldUpdater</li>
<li>AtomicStampedReference</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>《Java并发编程的艺术》读书笔记</p>]]>
    
    </summary>
    
      <category term="Java" scheme="http://ztmark.github.io/tags/Java/"/>
    
  </entry>
  
</feed>
